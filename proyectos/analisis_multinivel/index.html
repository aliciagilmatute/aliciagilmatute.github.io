<!DOCTYPE html>
<html>

<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<meta http-equiv="Accept-CH" content="DPR, Viewport-Width, Width">
<link rel="icon" href=/normal_fav_icon.png type="image/gif">


<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link rel="preload"
      as="style"
      href="https://fonts.googleapis.com/css2?family=Alata&family=Lora:ital,wght@0,400;0,500;0,600;0,700;1,400;1,500;1,600;1,700&family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&display=swap"
>
<link rel="stylesheet"
      href="https://fonts.googleapis.com/css2?family=Alata&family=Lora:ital,wght@0,400;0,500;0,600;0,700;1,400;1,500;1,600;1,700&family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&display=swap"
      media="print" onload="this.media='all'" />
<noscript>
  <link
          href="https://fonts.googleapis.com/css2?family=Alata&family=Lora:ital,wght@0,400;0,500;0,600;0,700;1,400;1,500;1,600;1,700&family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&display=swap"
          rel="stylesheet">
</noscript>


<link rel="stylesheet" href="/css/font.css" media="all">



<meta property="og:url" content="http://localhost:1313/proyectos/analisis_multinivel/">
  <meta property="og:site_name" content="Alicia Gil Matute">
  <meta property="og:title" content="Análisis Multinivel Bayesiano">
  <meta property="og:description" content="Estudio sobre análisis multinivel bayesiano de rendimiento en matemáticas entre 10 centros educativos.">
  <meta property="og:locale" content="es">
  <meta property="og:type" content="article">
    <meta property="article:section" content="proyectos">
    <meta property="article:published_time" content="2025-03-07T00:00:00+00:00">
    <meta property="article:modified_time" content="2025-03-07T00:00:00+00:00">


  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Análisis Multinivel Bayesiano">
  <meta name="twitter:description" content="Estudio sobre análisis multinivel bayesiano de rendimiento en matemáticas entre 10 centros educativos.">


<link rel="stylesheet" href="/bootstrap-5/css/bootstrap.min.css" media="all"><link rel="stylesheet" href="/css/header.css" media="all">
<link rel="stylesheet" href="/css/footer.css" media="all">


<link rel="stylesheet" href="/css/theme.css" media="all">

<style>
    :root {
        --text-color: #343a40;
        --text-secondary-color: #343a40;
        --text-link-color: #343a40;
        --background-color: #e1f0f6  ;
        --secondary-background-color: #64ffda1a;
        --primary-color: #21A7CC;
        --secondary-color: #FFFFFF;

         
        --text-color-dark: #e4e6eb;
        --text-secondary-color-dark: #b0b3b8;
        --text-link-color-dark: #ffffff;
        --background-color-dark: #18191a;
        --secondary-background-color-dark: #212529;
        --primary-color-dark: #ffffff;
        --secondary-color-dark: #212529;
    }
    body {
        font-size: 1rem;
        font-weight: 400;
        line-height: 1.5;
        text-align: left;
    }

    html {
        background-color: var(--background-color) !important;
    }

    body::-webkit-scrollbar {
        height: 0px;
        width: 8px;
        background-color: var(--background-color);
    }

    ::-webkit-scrollbar-track {
        border-radius: 1rem;
    }

    ::-webkit-scrollbar-thumb {
        border-radius: 1rem;
        background: #b0b0b0;
        outline: 1px solid var(--background-color);
    }

    #search-content::-webkit-scrollbar {
        width: .5em;
        height: .1em;
        background-color: var(--background-color);
    }
</style>



<meta name="description" content="Estudio sobre análisis multinivel bayesiano de rendimiento en matemáticas entre 10 centros educativos.">
<link rel="stylesheet" href="/css/single.css">


<script defer src="/fontawesome-6/all-6.4.2.js"></script>


<style>
  .btn-contact {
    transition: none;
    transition: opacity 0.3s;
    border-radius: .5rem !important;
    border: 1px solid var(--primary-color) !important;
    background-color: var(--secondary-color) !important;
    color: var(--text-color) !important;
    display: inline-block;
    padding: 0.5rem 1rem;
    text-decoration: none;
    font-weight: 500;
  }
  .btn-contact:hover { opacity: 0.7; }
  .btn-contact:focus { box-shadow: none !important; outline: none; }

   
  .copy-btn {
    font-family: "Inter", Arial, sans-serif;
    position: absolute;
    top: 0.5rem;
    right: 0.5rem;
    padding: 0.025rem 0.6rem;
    font-size: 0.75rem;
    border-radius: 0.5rem;
    background-color: var(--primary-color);
    color: white;
    border: 1px solid rgba(255, 255, 255, 0.2);
    cursor: pointer;
    transition: background-color 0.2s;
  }
  .copy-btn:hover { background-color: #5BB8CC; }
  body.dark .copy-btn { background-color: rgba(255,255,255,0.05); color: white; }
  body.dark .copy-btn:hover { background-color: #ccc; }

 
.code-container {
  position: relative;  
}

 
.code-container pre,
.code-container pre code {
  color: black !important;
  background-color: rgba(255,255,255,0.05);
  font-family: monospace;
}

 
.code-container pre code span {
  color: var(--text-color) !important;
  background: none !important;
}

   
  .materiales { text-align: left; margin: 2rem 0 1rem; font-size: 1rem; color: var(--text-color); }
  .materiales strong { display: block; margin-bottom: 0.75rem; }
  .materiales-botones { display: flex; gap: 0.75rem; }
  .materiales-botones a {
    display: inline-flex; align-items: center; justify-content: center;
    width: 48px; height: 48px;
    background-color: var(--primary-color);
    border-radius: 0.5rem;
    box-shadow: 0 2px 4px rgba(0,0,0,0.15);
    transition: background-color 0.2s ease, transform 0.1s ease;
  }
  .materiales-botones a:hover { background-color: #5BB8CC; transform: translateY(-2px); }
  .materiales-botones svg { width: 24px; height: 24px; fill: white; }
  body.dark .materiales-botones a { background-color: var(--primary-color-dark); }
  body.dark .materiales-botones a:hover { background-color: #ccc; }
  body.dark .materiales-botones svg { fill: var(--background-color-dark); }

   
  .tableau-section { text-align: center; margin: 3rem 0; }
  .tableau-container {
    position: relative;
    width: 100%;
    padding-bottom: 65%;  
    height: 0;
    overflow: hidden;
    border-radius: none;
    box-shadow: none;
  }
  .tableau-container iframe {
    position: absolute;
    top: 0; left: 0;
    width: 150%; height: 150%;
    transform: scale(0.75);  
    transform-origin: top left;
    border: none;
  }
</style>


  
  
    <link rel="stylesheet" href="/style.css">
  

  <title>
Análisis Multinivel Bayesiano | Alicia Gil Matute

  </title>
</head>

<body class="light">
  
  
<script>
    let localStorageValue = localStorage.getItem("pref-theme");
    let mediaQuery = window.matchMedia('(prefers-color-scheme: dark)').matches;

    switch (localStorageValue) {
        case "dark":
            document.body.classList.add('dark');
            break;
        case "light":
            document.body.classList.remove('dark');
            break;
        default:
            if (mediaQuery) {
                document.body.classList.add('dark');
            }
            break;
    }
</script>





<script>
    var prevScrollPos = window.pageYOffset;
    window.addEventListener("scroll", function showHeaderOnScroll() {
        let profileHeaderElem = document.getElementById("profileHeader");
        let currentScrollPos = window.pageYOffset;
        let resetHeaderStyle = false;
        let showNavBarOnScrollUp =  true ;
        let showNavBar = showNavBarOnScrollUp ? prevScrollPos > currentScrollPos : currentScrollPos > 0;
        if (showNavBar) {
            profileHeaderElem.classList.add("showHeaderOnTop");
        } else {
            resetHeaderStyle = true;
        }
        if(currentScrollPos === 0) {
            resetHeaderStyle = true;
        }
        if(resetHeaderStyle) {
            profileHeaderElem.classList.remove("showHeaderOnTop");
        }
        prevScrollPos = currentScrollPos;
    });
</script>



<header id="profileHeader">
    <nav class="pt-3 navbar navbar-expand-lg animate">
        <div class="container-fluid mx-xs-2 mx-sm-5 mx-md-5 mx-lg-5">
            
            <a class="navbar-brand primary-font text-wrap" href="/">
                
                
                
                    <img src="/normal_fav_icon.png" width="30" height="30" class="d-inline-block align-top">
                    Alicia Gil Matute
                
            </a>

            

            
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarContent"
                aria-controls="navbarContent" aria-expanded="false" aria-label="Toggle navigation">
                <svg aria-hidden="true" height="24" viewBox="0 0 16 16" version="1.1" width="24" data-view-component="true">
                    <path fill-rule="evenodd" d="M1 2.75A.75.75 0 011.75 2h12.5a.75.75 0 110 1.5H1.75A.75.75 0 011 2.75zm0 5A.75.75 0 011.75 7h12.5a.75.75 0 110 1.5H1.75A.75.75 0 011 7.75zM1.75 12a.75.75 0 100 1.5h12.5a.75.75 0 100-1.5H1.75z"></path>
                </svg>
            </button>

            
            <div class="collapse navbar-collapse text-wrap primary-font" id="navbarContent">
                <ul class="navbar-nav ms-auto text-center">
                    

                    

                    

                    

                    

                    

                    

                    

                    

                    
                    
                    
                    
                    <li class="nav-item navbar-text">
                        <a class="nav-link" href="/#about" title="">
                            
                            Sobre mí
                        </a>
                    </li>
                    
                    
                    
                    
                    <li class="nav-item navbar-text">
                        <a class="nav-link" href="/proyectos" title="Mis proyectos">
                            
                            Proyectos
                        </a>
                    </li>
                    
                    
                    
                    
                    <li class="nav-item navbar-text">
                        <a class="nav-link" href="/#experience" title="">
                            
                            Experiencia
                        </a>
                    </li>
                    
                    
                    
                    
                    <li class="nav-item navbar-text">
                        <a class="nav-link" href="/#education" title="">
                            
                            Formación
                        </a>
                    </li>
                    
                    
                    
                    
                    <li class="nav-item navbar-text">
                        <a class="nav-link" href="/blog" title="Blog posts">
                            
                            Blog
                        </a>
                    </li>
                    
                    
                    
                    
                    <li class="nav-item navbar-text">
                        <a class="nav-link" href="/recursos" title="Recursos de psicología y metodología">
                            
                            Recursos
                        </a>
                    </li>
                    
                    
                    
                    
                    <li class="nav-item navbar-text">
                        <a class="nav-link" href="/fotos" title="Fotos">
                            
                            Fotos
                        </a>
                    </li>
                    
                    
                    
                    
                    <li class="nav-item navbar-text">
                        <a class="nav-link" href="/#contact" title="">
                            
                            Contacto
                        </a>
                    </li>
                    
                    

                    
                    <li class="nav-item navbar-text">
                        
                        <div class="text-center">
                            <button id="theme-toggle">
                                <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                                </svg>
                                <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <circle cx="12" cy="12" r="5"></circle>
                                    <line x1="12" y1="1" x2="12" y2="3"></line>
                                    <line x1="12" y1="21" x2="12" y2="23"></line>
                                    <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                                    <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                                    <line x1="1" y1="12" x2="3" y2="12"></line>
                                    <line x1="21" y1="12" x2="23" y2="12"></line>
                                    <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                                    <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                                </svg>
                            </button>
                        </div>
                    </li>
                    

                </ul>
            </div>
        </div>
    </nav>
</header>
<div id="content">
<section id="single">
  <div class="container">
    <div class="row justify-content-center">
      
      <div class="col-sm-12 col-md-12 col-lg-9">
        <div class="pr-lg-4">
          
          

          
          <div class="title mb-5">
            <h1 class="project-title text-center mb-4">Análisis Multinivel Bayesiano</h1>
            <div class="text-center">
              
              Mar 7, 2025
              
              
              
            </div>
          </div>

          
          
            <p class="project-description text-center">Estudio sobre análisis multinivel bayesiano de rendimiento en matemáticas entre 10 centros educativos.</p>
          

          
          <div class="text-center mb-3">
            
          </div>
          
          
          <div class="materiales">
            <strong>Repositorios:</strong>
            <div class="materiales-botones">
              
                <a href="https://github.com/aliciagilmatute/Analisis-Multinivel-Bayesiano" target="_blank" aria-label="GitHub">
                  <svg role="img" viewBox="0 0 24 24">
                    <path d="M12 .297c-6.63 0-12 5.373-12 12 
                             0 5.303 3.438 9.8 8.205 11.387
                             .6.113.82-.258.82-.577
                             0-.285-.01-1.04-.015-2.04
                             -3.338.724-4.042-1.61-4.042-1.61
                             -.546-1.387-1.333-1.757-1.333-1.757
                             -1.09-.745.083-.729.083-.729
                             1.205.084 1.84 1.237 1.84 1.237
                             1.07 1.835 2.807 1.304 3.492.997
                             .108-.775.418-1.305.762-1.605
                             -2.665-.3-5.466-1.332-5.466-5.93
                             0-1.31.467-2.38 1.235-3.22
                             -.123-.303-.535-1.523.117-3.176
                             0 0 1.008-.322 3.301 1.23
                             a11.5 11.5 0 0 1 3.003-.404
                             11.48 11.48 0 0 1 3.003.404
                             c2.293-1.552 3.3-1.23 3.3-1.23
                             .653 1.653.241 2.873.118 3.176
                             .77.84 1.233 1.91 1.233 3.22
                             0 4.61-2.803 5.628-5.475 5.922
                             .43.372.823 1.102.823 2.222
                             0 1.606-.014 2.898-.014 3.293
                             0 .319.218.694.825.576
                             C20.565 22.092 24 17.592 24 12.297
                             c0-6.627-5.373-12-12-12"/>
                  </svg>
                </a>
              

              
                <a href="https://www.kaggle.com/code/arrobarsandias/" target="_blank" aria-label="Kaggle">
                  <svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                    <path d="M18.825 23.859c-.022.092-.117.141-.281.141h-3.139
                             c-.187 0-.351-.082-.492-.248l-5.178-6.589-1.448 1.374v5.111
                             c0 .235-.117.352-.351.352H5.505
                             c-.236 0-.354-.117-.354-.352V.353
                             c0-.233.118-.353.354-.353h2.431
                             c.234 0 .351.12.351.353v14.343l6.203-6.272
                             c.165-.165.33-.246.495-.246h3.239
                             c.144 0 .236.06.285.18.046.149.034.255-.036.315
                             l-6.555 6.344 6.836 8.507c.095.104.117.208.07.358"/>
                  </svg>
                </a>
              
            </div>
          </div>



          
          <article class="page-content p- project-content">
            <p><br><br></p>
<h2 id="una-aproximación-bayesiana-al-análisis-multinivel">Una Aproximación Bayesiana al Análisis Multinivel</h2>
<br>
<p>El análisis multinivel es un procedimiento estadístico que permite dar cuenta de la idiosincrasia y, por ende, de la variabilidad no solo de los individuos, sino de sus agrupaciones: instituciones, centros educativos, territorios, etc. <strong>Todo depende de la articulación teórica desde la cual se parta.</strong></p>
<p>Por ejemplo, se puede establecer como objeto de estudio a un grupo de personas formado por varios individuos y analizar las diferencias entre ellos (nivel 1), al mismo tiempo que se examinan las diferencias entre los grupos en los que dichos individuos se encuentran (nivel 2). Asimismo, es posible ampliar el modelo incorporando niveles adicionales, como territorios o países (nivel 3), para captar la variabilidad asociada a estructuras más complejas.</p>
<p>Esto da cuenta de la flexibilidad y utilidad de los análisis multinivel, característica muy apreciada por el enfoque bayesiano dado que:</p>
<blockquote>
<p>“La propia lógica de los métodos bayesianos se adapta de forma natural a los métodos de efectos aleatorios, en los que los parámetros pasan a ser considerados variables aleatorias.”<br>
<em>(Revuelta &amp; Ximénez, 2014)</em></p>
</blockquote>
<p>Por ello, este trabajo se compromete a explorar las posibilidades que ofrece el análisis multinivel bayesiano con datos recogidos en 10 centros educativos sobre el rendimiento de los estudiantes en matemáticas, centrando nuestro interés en la variabilidad existente entre centros, pero también en cada centro.</p>
<p><br><br></p>
<h2 id="método">Método</h2>
<p>Los datos se recogieron en 10 centros distintos (<code>schid</code>) cuya muestra total es de 260 estudiantes. Las variables medidas son:</p>
<ul>
<li><strong>Rendimiento en matemáticas</strong>: puntuación en una escala de 0-100. Variable dependiente (<code>math</code>).</li>
<li><strong>Horas de deberes de matemáticas</strong>: número de horas diarias que dedica cada estudiante. Variable predictora de primer nivel (<code>homework</code>).</li>
</ul>
<p>Puesto que nuestro interés reside en la exploración de la flexibilidad de los modelos multinivel, se han estimado 3 modelos:</p>
<hr>
<br>
<h3 id="modelo-0-intersecciones-aleatorias-sin-variable-predictora"><em>Modelo 0: Intersecciones aleatorias sin variable predictora</em></h3>
<p>No se tiene en cuenta ninguna variable predictora. Las intersecciones se consideran aleatorias entre centros.<br>
Parámetros estimados:</p>
<ul>
<li>Parte fija de la intersección: \(\mu_{0}\)</li>
<li>Parte aleatoria de la intersección: \(\omega^2_{0}\)</li>
<li>Varianza del error: \(\sigma^2_{e}\)</li>
</ul>
<p>Este modelo propone que las medias en el desempeño en matemáticas difieren entre centros, sin considerar ninguna variable predictora. Es el modelo nulo.</p>
<hr>
<br>
<h3 id="modelo-1-intersecciones-aletorias-pendientes-fijas-con-una-variable-predictora-de-primer-nivel"><em>Modelo 1: Intersecciones aletorias, pendientes fijas con una variable predictora de primer nivel</em></h3>
<p>Se introduce una variable predictora de primer nivel (<code>homework</code>). Se consideran intersecciones aleatorias y pendientes fijas.<br>
Parámetros estimados:</p>
<ul>
<li>Parte fija de la intersección: \(\mu_{0}\)</li>
<li>Parte aleatoria de la intersección: \(\omega^2_{0}\)</li>
<li>Parte fija de la pendiente: \(\mu_{1}\)</li>
<li>Varianza del error: \(\sigma^2_{e}\)</li>
</ul>
<p>Este modelo propone que las medias en el desempeño en matemáticas difieren entre centros teniendo en cuenta <code>homework</code>, pero asume que su efecto es el mismo en todos los colegios.</p>
<br>
<div style="display:flex; justify-content:center; gap:30px; align-items:flex-start;">
  <figure style="margin:0; width:360px; text-align:center;">
    <img src="/mcmc_plots_1.png" alt="Cadenas de Markov Monte Carlo de los parámetros del Modelo 1." width="480">
    <figcaption style="font-style:italic; margin-top:8px;">
      Figura 4. Cadenas de Markov Monte Carlo (MCMC) de los parámetros del Modelo 1.
    </figcaption>
  </figure>
  <figure style="margin:0; width:370px; text-align:center;">
    <img src="/pairs_plot_1.png" alt="Gráfica de pares MCMC que muestra las distribuciones marginales (diagonal) y las correlaciones entre parámetros (scatterplots fuera de la diagonal) del Modelo 1." width="480">
    <figcaption style="font-style:italic; margin-top:8px;">
      Figura 5. Gráfica de pares MCMC que muestra las distribuciones marginales (diagonal) y las correlaciones entre parámetros (scatterplots fuera de la diagonal) del Modelo 1.
    </figcaption>
  </figure>
  <figure style="margin:0; width:370px; text-align:center;">
    <img src="/cowplot_1.png" alt="Posterior Predictive Checks del Modelo 1." width="480">
    <figcaption style="font-style:italic; margin-top:8px;">
      Figura 6. Posterior Predictive Checks del Modelo 1.
    </figcaption>
  </figure>
</div>
<br><br>
<hr>
<br>
<h3 id="modelo-2-intersecciones-y-pendientes-aletorias-con-una-variable-predictora-de-primer-nivel"><em>Modelo 2: Intersecciones y pendientes aletorias con una variable predictora de primer nivel</em></h3>
<p>Igual al Modelo 1, pero con pendientes aleatorias entre centros.<br>
Parámetros estimados:</p>
<ul>
<li>Parte fija de la intersección: \(\mu_{0}\)</li>
<li>Parte aleatoria de la intersección: \(\omega^2_{0}\)</li>
<li>Parte fija de la pendiente: \(\mu_{1}\)</li>
<li>Parte aleatoria de la pendiente: \(\omega^2_{1}\)</li>
<li>Covarianza intersección–pendiente: \(\omega_{01}\)</li>
<li>Varianza del error: \(\sigma^2_{e}\)</li>
</ul>
<p>Este modelo propone que las medias en el desempeño en matemáticas difieren entre centros teniendo en cuenta <code>homework</code>, pero ahora se asume que el efecto de esta variable <strong>no es el mismo</strong> en todos los colegios.</p>
<p><br><br></p>
<h2 id="anexo-script-de-r-en-combinación-con-lenguaje-stan-cmdstanr">ANEXO: <em>Script de R en combinación con lenguaje Stan (cmdstanr)</em></h2>
<br>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#75715e"># ==============================================================================</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># HEADER: Script Information</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ==============================================================================</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Script Name: cmdstanr_version.R</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Author: Alicia Gil Matute</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Position: Data Scientist</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Date Created: 2025-03-07</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Email: aliciagilmatute@gmail.com</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ==============================================================================</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ==============================================================================</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># SECTION 1: Load packages</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Libraries necessary for the script to function</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ==============================================================================</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">library</span>(MASS)          <span style="color:#75715e"># Multivariate gaussian distribution</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">library</span>(cmdstanr)      <span style="color:#75715e"># Estimate bayesian models in Stan (better than rstan)</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">library</span>(posterior)     <span style="color:#75715e"># Extract summaries</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">library</span>(loo)           <span style="color:#75715e"># WAIC and LOO estimates</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">library</span>(haven)
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">library</span>(bayesplot)
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">library</span>(cowplot)
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">library</span>(ggplot2)
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">library</span>(blavaan)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ==============================================================================</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># SECTION 2: Load Data</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ==============================================================================</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>mlmdata <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">read_dta</span>(<span style="color:#e6db74">&#34;https://stats.idre.ucla.edu/stat/examples/imm/imm10.dta&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>x <span style="color:#f92672">&lt;-</span> <span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">10</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>mlmdata<span style="color:#f92672">$</span>schid <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">as.factor</span>(mlmdata<span style="color:#f92672">$</span>schid)
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">levels</span>(mlmdata<span style="color:#f92672">$</span>schid) <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">as.character</span>(x)
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">str</span>(mlmdata)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">View</span>(mlmdata)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>data_stan <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">list</span>(N <span style="color:#f92672">=</span> <span style="color:#a6e22e">nrow</span>(mlmdata), 
</span></span><span style="display:flex;"><span>                  J <span style="color:#f92672">=</span> <span style="color:#a6e22e">length</span>(<span style="color:#a6e22e">unique</span>(mlmdata<span style="color:#f92672">$</span>schid)),
</span></span><span style="display:flex;"><span>                  schid <span style="color:#f92672">=</span> <span style="color:#a6e22e">as.numeric</span>(mlmdata<span style="color:#f92672">$</span>schid), 
</span></span><span style="display:flex;"><span>                  homework <span style="color:#f92672">=</span> mlmdata<span style="color:#f92672">$</span>homework, 
</span></span><span style="display:flex;"><span>                  math <span style="color:#f92672">=</span> mlmdata<span style="color:#f92672">$</span>math)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">is.na</span>(data_stan)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">hist</span>(data_stan<span style="color:#f92672">$</span>schid)
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">hist</span>(data_stan<span style="color:#f92672">$</span>homework)
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">hist</span>(data_stan<span style="color:#f92672">$</span>math)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ==============================================================================</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># SECTION 3: Estimate bayesian multilevel model </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Model 0: No predictor variable and Random Intercepts</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ==============================================================================</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#Priors poco informativas:</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#beta0~normal(0,10);</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#sigma_e~gamma(1,0.5);    </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#sigma_u0~gamma(1,0.5);</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#u0~normal(0,sigma_u0);</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Compilamos el modelo</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>bmultinivel_0 <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">cmdstan_model</span>(stan_file <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;model0_cmdstanr_version.stan&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>bmultinivel_0f <span style="color:#f92672">&lt;-</span> bmultinivel_0<span style="color:#f92672">$</span><span style="color:#a6e22e">sample</span>(
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>  data <span style="color:#f92672">=</span> data_stan,       <span style="color:#75715e"># Stan data</span>
</span></span><span style="display:flex;"><span>  chains <span style="color:#f92672">=</span> <span style="color:#ae81ff">4</span>,            <span style="color:#75715e"># Number of chains</span>
</span></span><span style="display:flex;"><span>  parallel_chains <span style="color:#f92672">=</span> <span style="color:#ae81ff">4</span>,   <span style="color:#75715e"># Number of parallel chains</span>
</span></span><span style="display:flex;"><span>  iter_warmup <span style="color:#f92672">=</span> <span style="color:#ae81ff">500</span>,     <span style="color:#75715e"># Adaptation iterations</span>
</span></span><span style="display:flex;"><span>  iter_sampling <span style="color:#f92672">=</span> <span style="color:#ae81ff">1500</span>,  <span style="color:#75715e"># Sampled iterations</span>
</span></span><span style="display:flex;"><span>  refresh <span style="color:#f92672">=</span> <span style="color:#ae81ff">500</span>,         <span style="color:#75715e"># Progress bar at 500 iterations</span>
</span></span><span style="display:flex;"><span>  init <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>)              <span style="color:#75715e"># All starting values = 0</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#necesitamos extraer el posterior para visualizar las cadenas de Markov</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>posterior_samples0 <span style="color:#f92672">&lt;-</span> bmultinivel_0f<span style="color:#f92672">$</span><span style="color:#a6e22e">draws</span>()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">mcmc_trace</span>(posterior_samples0, pars <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;beta0&#34;</span>,<span style="color:#e6db74">&#34;sigma_u0&#34;</span>,<span style="color:#e6db74">&#34;sigma_e&#34;</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Posterior distribution: pairs plots</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">mcmc_pairs</span>(posterior_samples0, pars<span style="color:#f92672">=</span><span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;beta0&#34;</span>,<span style="color:#e6db74">&#34;sigma_u0&#34;</span>,<span style="color:#e6db74">&#34;sigma_e&#34;</span>), diag_fun <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;hist&#34;</span>, 
</span></span><span style="display:flex;"><span>           off_diag_fun <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;scatter&#34;</span>, off_diag_args <span style="color:#f92672">=</span> <span style="color:#a6e22e">list</span>(alpha <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.5</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">mcmc_intervals</span>(posterior_samples0, pars <span style="color:#f92672">=</span><span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;beta0&#34;</span>,<span style="color:#e6db74">&#34;sigma_u0&#34;</span>,<span style="color:#e6db74">&#34;sigma_e&#34;</span>) )
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#escuelas</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>params <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">paste0</span>(<span style="color:#e6db74">&#34;u0[&#34;</span>, <span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">10</span>, <span style="color:#e6db74">&#34;]&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">mcmc_trace</span>(posterior_samples0, pars <span style="color:#f92672">=</span> params)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">mcmc_hist</span>(posterior_samples0, pars<span style="color:#f92672">=</span>params)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#mcmc_scatter(posterior_samples, pars=c(&#34;u0[1]&#34;,&#34;u0[2]&#34;))</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">mcmc_intervals</span>(posterior_samples0, pars <span style="color:#f92672">=</span> params)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#Resultados </span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>bmultinivel_0f<span style="color:#f92672">$</span><span style="color:#a6e22e">summary</span>()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#EL AJUSTE A LOS DATOS (equivalente al ajuste global) con la cmdstanr SE EVALUA CON PPMC:</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#¿Podemos distinguir los datos observados de datos simulados desde el modelo (math_rep)?</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ==============================================================================</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># SECTION 3.b: Posterior Predictive Model Check (PPMC) MODELO 0</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ==============================================================================</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Extraer y_rep correctamente desde CmdStanR</span>
</span></span><span style="display:flex;"><span>y_rep_0 <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">as_draws_matrix</span>(bmultinivel_0f<span style="color:#f92672">$</span><span style="color:#a6e22e">draws</span>(<span style="color:#e6db74">&#34;y_rep&#34;</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Seleccionar solo 100 iteraciones aleatorias (iteraciones)</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">set.seed</span>(<span style="color:#ae81ff">123</span>)  <span style="color:#75715e"># Para reproducibilidad</span>
</span></span><span style="display:flex;"><span>y_rep_subset_0 <span style="color:#f92672">&lt;-</span> y_rep_0<span style="color:#a6e22e">[sample</span>(<span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#a6e22e">nrow</span>(y_rep_0), <span style="color:#ae81ff">100</span>), ]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Verificar dimensiones</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">dim</span>(y_rep_subset_0)  <span style="color:#75715e"># Debería ser (100, 300)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Número de colegios</span>
</span></span><span style="display:flex;"><span>J <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">length</span>(<span style="color:#a6e22e">unique</span>(data_stan<span style="color:#f92672">$</span>schid))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Lista para almacenar los gráficos</span>
</span></span><span style="display:flex;"><span>posterior_plots_list_0 <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">vector</span>(mode <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;list&#34;</span>, length <span style="color:#f92672">=</span> J)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Generar gráficos PPMC para cada colegio</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span>(j <span style="color:#66d9ef">in</span> <span style="color:#ae81ff">1</span><span style="color:#f92672">:</span>J){
</span></span><span style="display:flex;"><span>  posterior_plots_list_0[[j]] <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">ppc_dens_overlay</span>(
</span></span><span style="display:flex;"><span>    y <span style="color:#f92672">=</span> data_stan<span style="color:#f92672">$</span>math[data_stan<span style="color:#f92672">$</span>schid <span style="color:#f92672">==</span> j],        <span style="color:#75715e"># Datos reales del colegio j</span>
</span></span><span style="display:flex;"><span>    yrep <span style="color:#f92672">=</span> y_rep_subset_0[, data_stan<span style="color:#f92672">$</span>schid <span style="color:#f92672">==</span> j]  <span style="color:#75715e"># Simulaciones para colegio j</span>
</span></span><span style="display:flex;"><span>  ) <span style="color:#f92672">+</span> 
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">labs</span>(title <span style="color:#f92672">=</span> <span style="color:#a6e22e">paste</span>(<span style="color:#e6db74">&#34;Colegio&#34;</span>, j))
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Mostrar los gráficos juntos</span>
</span></span><span style="display:flex;"><span>cowplot<span style="color:#f92672">::</span><span style="color:#a6e22e">plot_grid</span>(plotlist <span style="color:#f92672">=</span> posterior_plots_list_0)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#####IMPORTANTE##########</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#No tiene sentido obtenerlo para beta0, sigma_uo y sigma_e porque son parametros de la distribucion (es un valor puntual &#34;inferido&#34;). En todo caso podria tener sentido obtenerlo para la beta0 ya que es la media de matematicas en las escuelas, pero es mas informativo tenerlo para cada escuela</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ==============================================================================</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># SECTION 4: Estimate bayesian multilevel model </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Model 1: Predictor variable and Random Intercepts and fixed Slopes</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ==============================================================================</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#Priors poco informativas:</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#beta[1]~normal(0,10);</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#beta[2]~normal(0,10);</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#sigma_e~gamma(1,0.5); </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#sigma_u0~gamma(1,0.5);</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#u0~normal(0,sigma_u0);</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Compilamos el modelo</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>bmultinivel_1  <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">cmdstan_model</span>(stan_file <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;model1_cdmstanr_version.stan&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>bmultinivel_1f <span style="color:#f92672">&lt;-</span> bmultinivel_1<span style="color:#f92672">$</span><span style="color:#a6e22e">sample</span>(
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>  data <span style="color:#f92672">=</span> data_stan,       <span style="color:#75715e"># Stan data</span>
</span></span><span style="display:flex;"><span>  chains <span style="color:#f92672">=</span> <span style="color:#ae81ff">4</span>,            <span style="color:#75715e"># Number of chains</span>
</span></span><span style="display:flex;"><span>  parallel_chains <span style="color:#f92672">=</span> <span style="color:#ae81ff">4</span>,   <span style="color:#75715e"># Number of parallel chains</span>
</span></span><span style="display:flex;"><span>  iter_warmup <span style="color:#f92672">=</span> <span style="color:#ae81ff">500</span>,     <span style="color:#75715e"># Adaptation iterations</span>
</span></span><span style="display:flex;"><span>  iter_sampling <span style="color:#f92672">=</span> <span style="color:#ae81ff">1500</span>,  <span style="color:#75715e"># Sampled iterations</span>
</span></span><span style="display:flex;"><span>  refresh <span style="color:#f92672">=</span> <span style="color:#ae81ff">500</span>,         <span style="color:#75715e"># Progress bar at 500 iterations</span>
</span></span><span style="display:flex;"><span>  init <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>)              <span style="color:#75715e"># All starting values = 0</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#necesitamos extraer el posterior para visualizar las cadenas de Markov</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>posterior_samples1 <span style="color:#f92672">&lt;-</span> bmultinivel_1f<span style="color:#f92672">$</span><span style="color:#a6e22e">draws</span>()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">mcmc_trace</span>(posterior_samples1, pars <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;beta[1]&#34;</span>,<span style="color:#e6db74">&#34;beta[2]&#34;</span>,<span style="color:#e6db74">&#34;sigma_u0&#34;</span>,<span style="color:#e6db74">&#34;sigma_e&#34;</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Posterior distribution: pairs plots</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">mcmc_pairs</span>(posterior_samples1, pars<span style="color:#f92672">=</span><span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;beta[1]&#34;</span>,<span style="color:#e6db74">&#34;beta[2]&#34;</span>,<span style="color:#e6db74">&#34;sigma_u0&#34;</span>,<span style="color:#e6db74">&#34;sigma_e&#34;</span>), 
</span></span><span style="display:flex;"><span>diag_fun <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;hist&#34;</span>,  off_diag_fun <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;scatter&#34;</span>, off_diag_args <span style="color:#f92672">=</span> <span style="color:#a6e22e">list</span>(alpha <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.5</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">mcmc_intervals</span>(posterior_samples1, pars <span style="color:#f92672">=</span><span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;beta[1]&#34;</span>,<span style="color:#e6db74">&#34;beta[2]&#34;</span>,<span style="color:#e6db74">&#34;sigma_u0&#34;</span>,<span style="color:#e6db74">&#34;sigma_e&#34;</span>) )
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#escuelas</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>params <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">paste0</span>(<span style="color:#e6db74">&#34;u0[&#34;</span>, <span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">10</span>, <span style="color:#e6db74">&#34;]&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">mcmc_trace</span>(posterior_samples1, pars <span style="color:#f92672">=</span> params)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">mcmc_hist</span>(posterior_samples1, pars<span style="color:#f92672">=</span>params)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#mcmc_scatter(posterior_samples, pars=c(&#34;u0[1]&#34;,&#34;u0[2]&#34;))</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">mcmc_intervals</span>(posterior_samples1, pars <span style="color:#f92672">=</span> params)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#Resultados </span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>bmultinivel_1f<span style="color:#f92672">$</span><span style="color:#a6e22e">summary</span>()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ==============================================================================</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># SECTION 4.b: Posterior Predictive Model Check (PPMC) MODELO 1 </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ==============================================================================</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Extraer y_rep correctamente desde CmdStanR</span>
</span></span><span style="display:flex;"><span>y_rep_1 <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">as_draws_matrix</span>(bmultinivel_1f<span style="color:#f92672">$</span><span style="color:#a6e22e">draws</span>(<span style="color:#e6db74">&#34;y_rep&#34;</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Seleccionar solo 100 iteraciones aleatorias (iteraciones)</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">set.seed</span>(<span style="color:#ae81ff">123</span>)  <span style="color:#75715e"># Para reproducibilidad</span>
</span></span><span style="display:flex;"><span>y_rep_subset_1 <span style="color:#f92672">&lt;-</span> y_rep_1<span style="color:#a6e22e">[sample</span>(<span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#a6e22e">nrow</span>(y_rep_1), <span style="color:#ae81ff">100</span>), ]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Verificar dimensiones</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">dim</span>(y_rep_subset_1)  <span style="color:#75715e"># Debería ser (100, 300)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Número de colegios</span>
</span></span><span style="display:flex;"><span>J <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">length</span>(<span style="color:#a6e22e">unique</span>(data_stan<span style="color:#f92672">$</span>schid))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Lista para almacenar los gráficos</span>
</span></span><span style="display:flex;"><span>posterior_plots_list_1 <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">vector</span>(mode <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;list&#34;</span>, length <span style="color:#f92672">=</span> J)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Generar gráficos PPMC para cada colegio</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span>(j <span style="color:#66d9ef">in</span> <span style="color:#ae81ff">1</span><span style="color:#f92672">:</span>J){
</span></span><span style="display:flex;"><span>  posterior_plots_list_1[[j]] <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">ppc_dens_overlay</span>(
</span></span><span style="display:flex;"><span>    y <span style="color:#f92672">=</span> data_stan<span style="color:#f92672">$</span>math[data_stan<span style="color:#f92672">$</span>schid <span style="color:#f92672">==</span> j],        <span style="color:#75715e"># Datos reales del colegio j</span>
</span></span><span style="display:flex;"><span>    yrep <span style="color:#f92672">=</span> y_rep_subset_1[, data_stan<span style="color:#f92672">$</span>schid <span style="color:#f92672">==</span> j]  <span style="color:#75715e"># Simulaciones para colegio j</span>
</span></span><span style="display:flex;"><span>  ) <span style="color:#f92672">+</span> 
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">labs</span>(title <span style="color:#f92672">=</span> <span style="color:#a6e22e">paste</span>(<span style="color:#e6db74">&#34;Colegio&#34;</span>, j))
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Mostrar los gráficos juntos</span>
</span></span><span style="display:flex;"><span>cowplot<span style="color:#f92672">::</span><span style="color:#a6e22e">plot_grid</span>(plotlist <span style="color:#f92672">=</span> posterior_plots_list_1)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ==============================================================================</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># SECTION 4.c: Comparacion de modelos (capacidad predictiva)</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ==============================================================================</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>loo_1f  <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">loo</span>(x <span style="color:#f92672">=</span> bmultinivel_0f<span style="color:#f92672">$</span><span style="color:#a6e22e">draws</span>(<span style="color:#e6db74">&#34;log_lik&#34;</span>))
</span></span><span style="display:flex;"><span>loo_2f  <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">loo</span>(x <span style="color:#f92672">=</span> bmultinivel_1f<span style="color:#f92672">$</span><span style="color:#a6e22e">draws</span>(<span style="color:#e6db74">&#34;log_lik&#34;</span>))
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">loo_compare</span>(loo_1f, loo_2f)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ==============================================================================</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># SECTION 5.a: Estimate bayesian multilevel model </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Model 2: Predictor variable and Random Intercepts and fixed Slopes</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ==============================================================================</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#Priors poco informativas:</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#  L_u ~ lkj_corr_cholesky(1);   </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#to_vector(z_u) ~ normal(0, 1);</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#beta~normal(0,10);</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#sigma_e~gamma(1,0.5); </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#sigma_u~gamma(1,0.5);</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>bmultinivel_2  <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">cmdstan_model</span>(stan_file <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;model2_cmdstanr_version.stan&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>bmultinivel_2f <span style="color:#f92672">&lt;-</span> bmultinivel_2<span style="color:#f92672">$</span><span style="color:#a6e22e">sample</span>(
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>  data <span style="color:#f92672">=</span> data_stan,       <span style="color:#75715e"># Stan data</span>
</span></span><span style="display:flex;"><span>  chains <span style="color:#f92672">=</span> <span style="color:#ae81ff">4</span>,            <span style="color:#75715e"># Number of chains</span>
</span></span><span style="display:flex;"><span>  parallel_chains <span style="color:#f92672">=</span> <span style="color:#ae81ff">4</span>,   <span style="color:#75715e"># Number of parallel chains</span>
</span></span><span style="display:flex;"><span>  iter_warmup <span style="color:#f92672">=</span> <span style="color:#ae81ff">500</span>,     <span style="color:#75715e"># Adaptation iterations</span>
</span></span><span style="display:flex;"><span>  iter_sampling <span style="color:#f92672">=</span> <span style="color:#ae81ff">1500</span>,  <span style="color:#75715e"># Sampled iterations</span>
</span></span><span style="display:flex;"><span>  refresh <span style="color:#f92672">=</span> <span style="color:#ae81ff">500</span>,         <span style="color:#75715e"># Progress bar at 500 iterations</span>
</span></span><span style="display:flex;"><span>  init <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>)              <span style="color:#75715e"># All starting values = 0</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#necesitamos extraer el posterior para visualizar las cadenas de Markov</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>posterior_samples2 <span style="color:#f92672">&lt;-</span> bmultinivel_2f<span style="color:#f92672">$</span><span style="color:#a6e22e">draws</span>()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#L_U[1,1] y L_u[1,2] no ha convergido pero L_u[2,1] si</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">mcmc_trace</span>(posterior_samples2, pars <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;beta[1]&#34;</span>,<span style="color:#e6db74">&#34;beta[2]&#34;</span>,<span style="color:#e6db74">&#34;sigma_u[1]&#34;</span>,<span style="color:#e6db74">&#34;sigma_u[2]&#34;</span>,<span style="color:#e6db74">&#34;sigma_e&#34;</span>,
</span></span><span style="display:flex;"><span>                                        <span style="color:#e6db74">&#34;L_u[1,1]&#34;</span>,<span style="color:#e6db74">&#34;L_u[2,1]&#34;</span>,<span style="color:#e6db74">&#34;L_u[2,2]&#34;</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Posterior distribution: pairs plots</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">mcmc_pairs</span>(posterior_samples2, pars<span style="color:#f92672">=</span><span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;beta[1]&#34;</span>,<span style="color:#e6db74">&#34;beta[2]&#34;</span>,<span style="color:#e6db74">&#34;sigma_u[1]&#34;</span>,<span style="color:#e6db74">&#34;sigma_u[2]&#34;</span>,<span style="color:#e6db74">&#34;sigma_e&#34;</span>), 
</span></span><span style="display:flex;"><span>           diag_fun <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;hist&#34;</span>,  off_diag_fun <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;scatter&#34;</span>, off_diag_args <span style="color:#f92672">=</span> <span style="color:#a6e22e">list</span>(alpha <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.5</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">mcmc_pairs</span>(posterior_samples2, pars<span style="color:#f92672">=</span><span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;L_u[1,1]&#34;</span>,<span style="color:#e6db74">&#34;L_u[2,1]&#34;</span>,<span style="color:#e6db74">&#34;L_u[2,2]&#34;</span>), 
</span></span><span style="display:flex;"><span>           diag_fun <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;hist&#34;</span>,  off_diag_fun <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;scatter&#34;</span>, off_diag_args <span style="color:#f92672">=</span> <span style="color:#a6e22e">list</span>(alpha <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.5</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">mcmc_intervals</span>(posterior_samples2, pars <span style="color:#f92672">=</span><span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;beta[1]&#34;</span>,<span style="color:#e6db74">&#34;beta[2]&#34;</span>,<span style="color:#e6db74">&#34;sigma_u[1]&#34;</span>,<span style="color:#e6db74">&#34;sigma_u[2]&#34;</span>,<span style="color:#e6db74">&#34;sigma_e&#34;</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">mcmc_intervals</span>(posterior_samples2, pars <span style="color:#f92672">=</span><span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;L_u[1,1]&#34;</span>,<span style="color:#e6db74">&#34;L_u[2,1]&#34;</span>,<span style="color:#e6db74">&#34;L_u[2,2]&#34;</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#escuelas</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>params <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">paste0</span>(<span style="color:#e6db74">&#34;u0[&#34;</span>, <span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">10</span>, <span style="color:#e6db74">&#34;]&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">mcmc_trace</span>(posterior_samples2, pars <span style="color:#f92672">=</span> params)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">mcmc_hist</span>(posterior_samples2, pars<span style="color:#f92672">=</span>params)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#mcmc_scatter(posterior_samples, pars=c(&#34;u0[1]&#34;,&#34;u0[2]&#34;))</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">mcmc_intervals</span>(posterior_samples2, pars <span style="color:#f92672">=</span> params)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#Resultados </span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>bmultinivel_2f<span style="color:#f92672">$</span><span style="color:#a6e22e">summary</span>()
</span></span><span style="display:flex;"><span>bmultinivel_2f<span style="color:#f92672">$</span><span style="color:#a6e22e">summary</span>(<span style="color:#e6db74">&#34;R&#34;</span>)
</span></span><span style="display:flex;"><span>bmultinivel_2f<span style="color:#f92672">$</span><span style="color:#a6e22e">summary</span>(<span style="color:#e6db74">&#34;u0&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#en el script de stan se puede indicar directamente que calcule la media de cada colegio a partir</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#de cada u0[j]</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#Los parametros de nuestr interés son:</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#beta[1]: parte fija interseccion</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#beta[2]: parte fija pendientes</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#sigma_u[1]: parte aleatoria interseccion</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#sigma_u[2]: parte aleatoria pendientes</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#R[1,2]: covarianza pendientes aleatorias</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#sigma_e: varianza error</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#L_u[i,j]: las necesito para crear R[i,j]***</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ==============================================================================</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># SECTION 5.b: Posterior Predictive Model Check (PPMC) MODELO 1 </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ==============================================================================</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Extraer y_rep correctamente desde CmdStanR</span>
</span></span><span style="display:flex;"><span>y_rep_2 <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">as_draws_matrix</span>(bmultinivel_2f<span style="color:#f92672">$</span><span style="color:#a6e22e">draws</span>(<span style="color:#e6db74">&#34;y_rep&#34;</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Seleccionar solo 100 iteraciones aleatorias (iteraciones)</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">set.seed</span>(<span style="color:#ae81ff">123</span>)  <span style="color:#75715e"># Para reproducibilidad</span>
</span></span><span style="display:flex;"><span>y_rep_subset_2 <span style="color:#f92672">&lt;-</span> y_rep_2<span style="color:#a6e22e">[sample</span>(<span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#a6e22e">nrow</span>(y_rep_2), <span style="color:#ae81ff">100</span>), ]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Verificar dimensiones</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">dim</span>(y_rep_subset_2)  <span style="color:#75715e"># Debería ser (100, 300)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Número de colegios</span>
</span></span><span style="display:flex;"><span>J <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">length</span>(<span style="color:#a6e22e">unique</span>(data_stan<span style="color:#f92672">$</span>schid))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Lista para almacenar los gráficos</span>
</span></span><span style="display:flex;"><span>posterior_plots_list_2 <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">vector</span>(mode <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;list&#34;</span>, length <span style="color:#f92672">=</span> J)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Generar gráficos PPMC para cada colegio</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span>(j <span style="color:#66d9ef">in</span> <span style="color:#ae81ff">1</span><span style="color:#f92672">:</span>J){
</span></span><span style="display:flex;"><span>  posterior_plots_list_2[[j]] <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">ppc_dens_overlay</span>(
</span></span><span style="display:flex;"><span>    y <span style="color:#f92672">=</span> data_stan<span style="color:#f92672">$</span>math[data_stan<span style="color:#f92672">$</span>schid <span style="color:#f92672">==</span> j],        <span style="color:#75715e"># Datos reales del colegio j</span>
</span></span><span style="display:flex;"><span>    yrep <span style="color:#f92672">=</span> y_rep_subset_2[, data_stan<span style="color:#f92672">$</span>schid <span style="color:#f92672">==</span> j]  <span style="color:#75715e"># Simulaciones para colegio j</span>
</span></span><span style="display:flex;"><span>  ) <span style="color:#f92672">+</span> 
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">labs</span>(title <span style="color:#f92672">=</span> <span style="color:#a6e22e">paste</span>(<span style="color:#e6db74">&#34;Colegio&#34;</span>, j))
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Mostrar los gráficos juntos</span>
</span></span><span style="display:flex;"><span>cowplot<span style="color:#f92672">::</span><span style="color:#a6e22e">plot_grid</span>(plotlist <span style="color:#f92672">=</span> posterior_plots_list_2)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ==============================================================================</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># SECTION 5.c: Comparacion de modelos (capacidad predictiva)</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ==============================================================================</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>loo_1f  <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">loo</span>(x <span style="color:#f92672">=</span> bmultinivel_0f<span style="color:#f92672">$</span><span style="color:#a6e22e">draws</span>(<span style="color:#e6db74">&#34;log_lik&#34;</span>))
</span></span><span style="display:flex;"><span>loo_2f  <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">loo</span>(x <span style="color:#f92672">=</span> bmultinivel_1f<span style="color:#f92672">$</span><span style="color:#a6e22e">draws</span>(<span style="color:#e6db74">&#34;log_lik&#34;</span>))
</span></span><span style="display:flex;"><span>loo_3f <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">loo</span>(x<span style="color:#f92672">=</span>bmultinivel_2f<span style="color:#f92672">$</span><span style="color:#a6e22e">draws</span>(<span style="color:#e6db74">&#34;log_lik&#34;</span>))
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">loo_compare</span>(loo_1f, loo_2f, loo_3f)
</span></span></code></pre></div><p><br><br></p>

          </article>

          
          

          
          <div class="text-center mt-4">
            <a href="/proyectos" class="btn-contact">Volver a Proyectos</a>
          </div>
        </div>
      </div>

      
      <div class="col-sm-12 col-md-12 col-lg-3">
        <div id="stickySideBar" class="sticky-sidebar">
          
          <aside class="toc">
              <h5>Tabla de Contenidos</h5>
              <div class="toc-content"><nav id="TableOfContents">
  <ul>
    <li><a href="#una-aproximación-bayesiana-al-análisis-multinivel">Una Aproximación Bayesiana al Análisis Multinivel</a></li>
    <li><a href="#método">Método</a>
      <ul>
        <li><a href="#modelo-0-intersecciones-aleatorias-sin-variable-predictora"><em>Modelo 0: Intersecciones aleatorias sin variable predictora</em></a></li>
        <li><a href="#modelo-1-intersecciones-aletorias-pendientes-fijas-con-una-variable-predictora-de-primer-nivel"><em>Modelo 1: Intersecciones aletorias, pendientes fijas con una variable predictora de primer nivel</em></a></li>
        <li><a href="#modelo-2-intersecciones-y-pendientes-aletorias-con-una-variable-predictora-de-primer-nivel"><em>Modelo 2: Intersecciones y pendientes aletorias con una variable predictora de primer nivel</em></a></li>
      </ul>
    </li>
    <li><a href="#anexo-script-de-r-en-combinación-con-lenguaje-stan-cmdstanr">ANEXO: <em>Script de R en combinación con lenguaje Stan (cmdstanr)</em></a></li>
  </ul>
</nav></div>
          </aside>
          

          

          
          <aside class="social">
            <h5>Social</h5>
            <div class="social-content">
              <ul class="list-inline">
                <li class="list-inline-item text-center"><a target="_blank" href="https://www.linkedin.com/shareArticle?mini=true&url=http%3a%2f%2flocalhost%3a1313%2fproyectos%2fanalisis_multinivel%2f"><i class="fab fa-linkedin"></i></a></li>
                <li class="list-inline-item text-center"><a target="_blank" href="https://twitter.com/share?text=An%c3%a1lisis%20Multinivel%20Bayesiano&url=http%3a%2f%2flocalhost%3a1313%2fproyectos%2fanalisis_multinivel%2f"><i class="fab fa-twitter"></i></a></li>
                <li class="list-inline-item text-center"><a target="_blank" href="https://api.whatsapp.com/send?text=An%c3%a1lisis%20Multinivel%20Bayesiano: http%3a%2f%2flocalhost%3a1313%2fproyectos%2fanalisis_multinivel%2f"><i class="fab fa-whatsapp"></i></a></li>
                <li class="list-inline-item text-center"><a target="_blank" href='mailto:?subject=An%c3%a1lisis%20Multinivel%20Bayesiano&amp;body=Check%20out%20this%20site http%3a%2f%2flocalhost%3a1313%2fproyectos%2fanalisis_multinivel%2f'><i class="fa fa-envelope"></i></a></li>
              </ul>
            </div>
          </aside>
          
        </div>
      </div>
    </div>

  
  <button class="p-2 px-3" onclick="topFunction()" id="topScroll"><i class="fas fa-angle-up"></i></button>
</section>



<div class="progress"><div id="scroll-progress-bar" class="progress-bar" role="progressbar"></div></div>
<script src="/js/scrollProgressBar.js"></script>



<script>
  var topScroll = document.getElementById("topScroll");
  window.onscroll = function() {scrollFunction()};
  function scrollFunction() {
    if (document.body.scrollTop > 20 || document.documentElement.scrollTop > 20) { topScroll.style.display = "block"; }
    else { topScroll.style.display = "none"; }
  }
  function topFunction() { document.body.scrollTop = 0; document.documentElement.scrollTop = 0; }

  
  let stickySideBarElem = document.getElementById("stickySideBar");
  let stickyNavBar =  true ;
  if(stickyNavBar) {
    let headerElem = document.getElementById("profileHeader");
    let headerHeight = headerElem.offsetHeight + 15;
    stickySideBarElem.style.top = headerHeight + "px";
  } else {
    stickySideBarElem.style.top = "50px";
  }
</script>



<script src="/js/readingTime.js"></script>



<script>
  document.addEventListener("DOMContentLoaded", function () {
    document.querySelectorAll("pre > code").forEach((codeBlock) => {
      const pre = codeBlock.parentNode;
      const container = document.createElement("div");
      container.classList.add("code-container");
      pre.parentNode.insertBefore(container, pre);
      container.appendChild(pre);
      const button = document.createElement("button");
      button.className = "copy-btn"; button.textContent = "Copy";
      button.addEventListener("click", () => {
        navigator.clipboard.writeText(codeBlock.innerText).then(() => {
          button.textContent = "Copied!"; setTimeout(() => (button.textContent = "Copy"), 2000);
        });
      });
      container.appendChild(button);
    });
  });
</script>

<footer class="py-4 text-center">
  <p>&copy; 2025 Alicia Gil Matute</p>
</footer>

  </div><footer>
    
 

<div class="text-center pt-2">
    
    <span class="px-1">
        <a href="https://github.com/aliciagilmatute" aria-label="github">
            <svg xmlns="http://www.w3.org/2000/svg" width="2.7em" height="2.7em" viewBox="0 0 1792 1792">
                <path id="footer-socialNetworks-github-svg-path"
                    d="M522 1352q-8 9-20-3-13-11-4-19 8-9 20 3 12 11 4 19zm-42-61q9 12 0 19-8 6-17-7t0-18q9-7 17 6zm-61-60q-5 7-13 2-10-5-7-12 3-5 13-2 10 5 7 12zm31 34q-6 7-16-3-9-11-2-16 6-6 16 3 9 11 2 16zm129 112q-4 12-19 6-17-4-13-15t19-7q16 5 13 16zm63 5q0 11-16 11-17 2-17-11 0-11 16-11 17-2 17 11zm58-10q2 10-14 14t-18-8 14-15q16-2 18 9zm964-956v960q0 119-84.5 203.5t-203.5 84.5h-224q-16 0-24.5-1t-19.5-5-16-14.5-5-27.5v-239q0-97-52-142 57-6 102.5-18t94-39 81-66.5 53-105 20.5-150.5q0-121-79-206 37-91-8-204-28-9-81 11t-92 44l-38 24q-93-26-192-26t-192 26q-16-11-42.5-27t-83.5-38.5-86-13.5q-44 113-7 204-79 85-79 206 0 85 20.5 150t52.5 105 80.5 67 94 39 102.5 18q-40 36-49 103-21 10-45 15t-57 5-65.5-21.5-55.5-62.5q-19-32-48.5-52t-49.5-24l-20-3q-21 0-29 4.5t-5 11.5 9 14 13 12l7 5q22 10 43.5 38t31.5 51l10 23q13 38 44 61.5t67 30 69.5 7 55.5-3.5l23-4q0 38 .5 103t.5 68q0 22-11 33.5t-22 13-33 1.5h-224q-119 0-203.5-84.5t-84.5-203.5v-960q0-119 84.5-203.5t203.5-84.5h960q119 0 203.5 84.5t84.5 203.5z" />

                <metadata>
                    <rdf:RDF xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"
                        xmlns:rdfs="http://www.w3.org/2000/01/rdf-schema#" xmlns:dc="http://purl.org/dc/elements/1.1/">
                        <rdf:Description about="https://iconscout.com/legal#licenses"
                            dc:title="Github, Online, Project, Hosting, Square"
                            dc:description="Github, Online, Project, Hosting, Square" dc:publisher="Iconscout"
                            dc:date="2016-12-14" dc:format="image/svg+xml" dc:language="en">
                            <dc:creator>
                                <rdf:Bag>
                                    <rdf:li>Font Awesome</rdf:li>
                                </rdf:Bag>
                            </dc:creator>
                        </rdf:Description>
                    </rdf:RDF>
                </metadata>
            </svg>
        </a>
    </span>
    

    
    <span class="px-1">
        <a href="https://www.linkedin.com/in/alicia-gil-matute/" aria-label="linkedin">
            <svg xmlns="http://www.w3.org/2000/svg" width='2.4em' height='2.4em' fill="#fff" aria-label="LinkedIn"
                viewBox="0 0 512 512">
                <rect width="512" height="512" fill="#0077b5" rx="15%" />
                <circle cx="142" cy="138" r="37" />
                <path stroke="#fff" stroke-width="66" d="M244 194v198M142 194v198" />
                <path d="M276 282c0-20 13-40 36-40 24 0 33 18 33 45v105h66V279c0-61-32-89-76-89-34 0-51 19-59 32" />
            </svg>
        </a>
    </span>
    

    
    <a href="https://x.com/arrobarsandias" aria-label="twitter">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 48 48" width="48px" height="48px">
            <path fill="#03a9f4"
                d="M42,37c0,2.762-2.239,5-5,5H11c-2.762,0-5-2.238-5-5V11c0-2.762,2.238-5,5-5h26c2.761,0,5,2.238,5,5 V37z" />
            <path fill="#fff"
                d="M36,17.12c-0.882,0.391-1.999,0.758-3,0.88c1.018-0.604,2.633-1.862,3-3 c-0.951,0.559-2.671,1.156-3.793,1.372C31.311,15.422,30.033,15,28.617,15C25.897,15,24,17.305,24,20v2c-4,0-7.9-3.047-10.327-6 c-0.427,0.721-0.667,1.565-0.667,2.457c0,1.819,1.671,3.665,2.994,4.543c-0.807-0.025-2.335-0.641-3-1c0,0.016,0,0.036,0,0.057 c0,2.367,1.661,3.974,3.912,4.422C16.501,26.592,16,27,14.072,27c0.626,1.935,3.773,2.958,5.928,3c-1.686,1.307-4.692,2-7,2 c-0.399,0-0.615,0.022-1-0.023C14.178,33.357,17.22,34,20,34c9.057,0,14-6.918,14-13.37c0-0.212-0.007-0.922-0.018-1.13 C34.95,18.818,35.342,18.104,36,17.12" />
        </svg>
    </a>
    

    

    
</div><div class="container py-4">
    <div class="row justify-content-center">
        <div class="col-md-4 text-center">
            
                <div class="pb-2">
                    <a href="http://localhost:1313/" title="Alicia Gil Matute">
                        <img alt="Footer logo" src="/normal_fav_icon.png"
                            height="40px" width="40px">
                    </a>
                </div>
            
            &copy; 2025  All rights reserved
            <div class="text-secondary">
                Made with
                <span class="text-danger">
                    &#10084;
                </span>
                and
                <a href="https://github.com/gurusabarish/hugo-profile" target="_blank"
                    title="Designed and developed by gurusabarish">
                    Hugo Profile
                </a>
            </div>
        </div>
    </div>
</div>
</footer><script src="/bootstrap-5/js/bootstrap.bundle.min.js"></script>
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

    var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'))
    var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
        return new bootstrap.Tooltip(tooltipTriggerEl)
    })

</script>






<!-- MathJax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.2/es5/tex-mml-chtml.min.js" integrity="sha384-M5jmNxKC9EVnuqeMwRHvFuYUE8Hhp0TgBruj/GZRkYtiMrCRgH7yvv5KY+Owi7TW" crossorigin="anonymous"></script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      tex2jax: {
        inlineMath: [['\\(','\\)']],
        displayMath: [['$$','$$'], ['\[','\]']],
        processEscapes: true,
        processEnvironments: true,
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre'],
        TeX: { equationNumbers: { autoNumber: "AMS" },
             extensions: ["AMSmath.js", "AMSsymbols.js"] }
      }
    });
</script>








  <section id="search-content" class="py-2">
    <div class="container" id="search-results"></div>
  </section>
</body>

</html>
