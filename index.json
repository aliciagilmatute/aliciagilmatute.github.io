[{"content":"\u003c!-- # Emulación de una semana de trabajo en DataScientist --\u003e\r\n\u003cp\u003e\u003cbr\u003e\u003cbr\u003e\nEl gran objetivo del proyecto en el que vas a trabajar es reducir el abandono de empleados de la empresa.\nEl principal problema es la rotación de empleados. Deberás trabajar en un sistema que consiga reducir la fuga de empleados.\n\u003cbr\u003e\u003cbr\u003e\u003c/p\u003e\n\u003ch3 id=\"objetivosbr\"\u003eObjetivos\u003cbr\u003e\u003c/h3\u003e\n\u003col\u003e\n\u003cli\u003eEntender y cuantificar el problema desde el punto de vista de negocio\u003c/li\u003e\n\u003cli\u003eDesarrollar un sistema automatizado de machine learning que identifique a los empleados que están en mayor riesgo de fuga\u003c/li\u003e\n\u003cli\u003eComunicar los resultados de forma exitosa a la dirección\n\u003cbr\u003e\u003cbr\u003e\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch3 id=\"fasesbr\"\u003eFases\u003cbr\u003e\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003e\u003cstrong\u003eBusiness Analytics\u003c/strong\u003e: entender y cuantificar el problema\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eMachine Learning\u003c/strong\u003e: desarrollar un modelo predictivo\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eVisualización y Comunicación\u003c/strong\u003e: generar un cuadro de mando\n\u003cbr\u003e\u003cbr\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003c!-- \u003ciframe \r\n    src=\"/jupyter-notebooks-hugo/_build/html/notebooks/fuga_empleados.html\"\r\n    width=\"100%\" height=\"1000\" frameborder=\"0\" scrolling=\"yes\"\u003e\r\n\u003c/iframe\u003e\r\n --\u003e\r\n\u003ch2 id=\"business-analyticsbr\"\u003eBusiness Analytics\u003cbr\u003e\u003c/h2\u003e\n\u003ch3 id=\"carga-de-librerías-y-dataset\"\u003eCarga de librerías y dataset\u003c/h3\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-python\" data-lang=\"python\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003eimport\u003c/span\u003e numpy \u003cspan style=\"color:#66d9ef\"\u003eas\u003c/span\u003e np\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003eimport\u003c/span\u003e pandas \u003cspan style=\"color:#66d9ef\"\u003eas\u003c/span\u003e pd \n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003eimport\u003c/span\u003e matplotlib.pyplot \u003cspan style=\"color:#66d9ef\"\u003eas\u003c/span\u003e plt\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003eimport\u003c/span\u003e os\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eruta \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e os\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003epath\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003ejoin(os\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003egetcwd())\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003edf \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e pd\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eread_csv(ruta \u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003er\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;/data/AbandonoEmpleados.csv\u0026#39;\u003c/span\u003e, sep\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;;\u0026#39;\u003c/span\u003e, na_values\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;#N/D\u0026#39;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003edf\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003ehead()\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003edf\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003einfo()\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch3 id=\"análisis-de-nulos\"\u003eAnálisis de nulos\u003c/h3\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-python\" data-lang=\"python\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003edf\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eisnull()\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003esum()\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003esort_values(ascending\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#66d9ef\"\u003eFalse\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eConclusiones:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eEliminamos columnas con muchos nulos: \u003ccode\u003eaños_en_puesto\u003c/code\u003e y \u003ccode\u003econciliacion\u003c/code\u003e.\u003c/li\u003e\n\u003cli\u003eImputamos valores en \u003ccode\u003esexo\u003c/code\u003e, \u003ccode\u003eeducación\u003c/code\u003e, \u003ccode\u003esatisfacción\u003c/code\u003e e \u003ccode\u003eimplicación\u003c/code\u003e.\u003c/li\u003e\n\u003c/ul\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-python\" data-lang=\"python\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003edf\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003edrop(columns \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e [\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;anos_en_puesto\u0026#39;\u003c/span\u003e,\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;conciliacion\u0026#39;\u003c/span\u003e], inplace \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003eTrue\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003edf[\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;educacion\u0026#39;\u003c/span\u003e] \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e df[\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;educacion\u0026#39;\u003c/span\u003e]\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003efillna(\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;Universitaria\u0026#39;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003edf[\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;implicacion\u0026#39;\u003c/span\u003e] \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e df[\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;implicacion\u0026#39;\u003c/span\u003e]\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003efillna(\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;Alta\u0026#39;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003edf[\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;satisfaccion_trabajo\u0026#39;\u003c/span\u003e] \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e df[\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;satisfaccion_trabajo\u0026#39;\u003c/span\u003e]\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003efillna(\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;Alta\u0026#39;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch3 id=\"variables-numéricas\"\u003eVariables numéricas\u003c/h3\u003e\n\u003cp\u003eConclusiones:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eEliminamos \u003ccode\u003esexo\u003c/code\u003e, \u003ccode\u003eempleados\u003c/code\u003e, \u003ccode\u003ehoras_quincena\u003c/code\u003e.\u003c/li\u003e\n\u003c/ul\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-python\" data-lang=\"python\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003edf\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003edrop(columns\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e[\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;sexo\u0026#39;\u003c/span\u003e,\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;empleados\u0026#39;\u003c/span\u003e,\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;horas_quincena\u0026#39;\u003c/span\u003e], inplace\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#66d9ef\"\u003eTrue\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch3 id=\"generación-de-insights\"\u003eGeneración de insights\u003c/h3\u003e\n\u003cp\u003e\u003cstrong\u003eTasa de abandono\u003c/strong\u003e\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-python\" data-lang=\"python\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003edf[\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;abandono\u0026#39;\u003c/span\u003e]\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003evalue_counts(normalize\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#66d9ef\"\u003eTrue\u003c/span\u003e)\u003cspan style=\"color:#f92672\"\u003e*\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e100\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e\u003cstrong\u003eImpacto económico\u003c/strong\u003e\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-python\" data-lang=\"python\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003edf[\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;salario_ano\u0026#39;\u003c/span\u003e] \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e df[\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;salario_mes\u0026#39;\u003c/span\u003e] \u003cspan style=\"color:#f92672\"\u003e*\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e12\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003econdiciones\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e[\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    (df[\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;salario_ano\u0026#39;\u003c/span\u003e]\u003cspan style=\"color:#f92672\"\u003e\u0026lt;=\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e30000\u003c/span\u003e),\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    (df[\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;salario_ano\u0026#39;\u003c/span\u003e]\u003cspan style=\"color:#f92672\"\u003e\u0026gt;\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e30000\u003c/span\u003e) \u003cspan style=\"color:#f92672\"\u003e\u0026amp;\u003c/span\u003e (df[\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;salario_ano\u0026#39;\u003c/span\u003e]\u003cspan style=\"color:#f92672\"\u003e\u0026lt;=\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e50000\u003c/span\u003e),\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    (df[\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;salario_ano\u0026#39;\u003c/span\u003e]\u003cspan style=\"color:#f92672\"\u003e\u0026gt;\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e50000\u003c/span\u003e) \u003cspan style=\"color:#f92672\"\u003e\u0026amp;\u003c/span\u003e (df[\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;salario_ano\u0026#39;\u003c/span\u003e]\u003cspan style=\"color:#f92672\"\u003e\u0026lt;=\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e75000\u003c/span\u003e),\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    (df[\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;salario_ano\u0026#39;\u003c/span\u003e]\u003cspan style=\"color:#f92672\"\u003e\u0026gt;\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e75000\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e]\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eponderaciones\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e[df[\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;salario_ano\u0026#39;\u003c/span\u003e]\u003cspan style=\"color:#f92672\"\u003e*\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e0.161\u003c/span\u003e, df[\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;salario_ano\u0026#39;\u003c/span\u003e]\u003cspan style=\"color:#f92672\"\u003e*\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e0.197\u003c/span\u003e, df[\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;salario_ano\u0026#39;\u003c/span\u003e]\u003cspan style=\"color:#f92672\"\u003e*\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e0.204\u003c/span\u003e, df[\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;salario_ano\u0026#39;\u003c/span\u003e]\u003cspan style=\"color:#f92672\"\u003e*\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e0.21\u003c/span\u003e]\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003edf[\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;impacto_abandono\u0026#39;\u003c/span\u003e] \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e np\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eselect(condiciones, ponderaciones, default\u003cspan style=\"color:#f92672\"\u003e=-\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e999\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ecoste_total \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e df\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eloc[df[\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;abandono\u0026#39;\u003c/span\u003e]\u003cspan style=\"color:#f92672\"\u003e==\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;Yes\u0026#39;\u003c/span\u003e]\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eimpacto_abandono\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003esum()\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch2 id=\"machine-learning\"\u003eMachine Learning\u003c/h2\u003e\n\u003ch3 id=\"preparación-de-datos\"\u003ePreparación de datos\u003c/h3\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-python\" data-lang=\"python\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003edf[\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;abandono\u0026#39;\u003c/span\u003e] \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e df\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eabandono\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003emap({\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;No\u0026#39;\u003c/span\u003e:\u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e, \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;Yes\u0026#39;\u003c/span\u003e:\u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e})\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003efrom\u003c/span\u003e sklearn.preprocessing \u003cspan style=\"color:#f92672\"\u003eimport\u003c/span\u003e OneHotEncoder\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003edf_ml \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e df\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003ecopy()\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ecat \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e df_ml\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eselect_dtypes(\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;O\u0026#39;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eohe \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e OneHotEncoder(sparse_output\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#66d9ef\"\u003eFalse\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eohe\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003efit(cat)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ecat_ohe \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e pd\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eDataFrame(ohe\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003etransform(cat), columns\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003eohe\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eget_feature_names_out(cat\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003ecolumns))\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003ereset_index(drop\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#66d9ef\"\u003eTrue\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003enum \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e df_ml\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eselect_dtypes(\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;number\u0026#39;\u003c/span\u003e)\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003ereset_index(drop\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#66d9ef\"\u003eTrue\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003edf_ml \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e pd\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003econcat([cat_ohe, num], axis\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch3 id=\"modelos-candidatos\"\u003eModelos candidatos\u003c/h3\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-python\" data-lang=\"python\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003efrom\u003c/span\u003e sklearn.model_selection \u003cspan style=\"color:#f92672\"\u003eimport\u003c/span\u003e train_test_split, StratifiedKFold, cross_val_score\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003efrom\u003c/span\u003e sklearn.linear_model \u003cspan style=\"color:#f92672\"\u003eimport\u003c/span\u003e LogisticRegression\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003efrom\u003c/span\u003e sklearn.ensemble \u003cspan style=\"color:#f92672\"\u003eimport\u003c/span\u003e RandomForestClassifier\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003efrom\u003c/span\u003e sklearn.neighbors \u003cspan style=\"color:#f92672\"\u003eimport\u003c/span\u003e KNeighborsClassifier\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003efrom\u003c/span\u003e sklearn.svm \u003cspan style=\"color:#f92672\"\u003eimport\u003c/span\u003e SVC\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eX \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e df_ml\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003edrop(columns\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;abandono\u0026#39;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ey \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e df_ml[\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;abandono\u0026#39;\u003c/span\u003e]\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eX_train, X_test, y_train, y_test \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e train_test_split(X, y, test_size\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e0.3\u003c/span\u003e, random_state\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e42\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003emodels \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e [\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    (\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;LR\u0026#39;\u003c/span\u003e, LogisticRegression(solver\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;liblinear\u0026#39;\u003c/span\u003e, multi_class\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;ovr\u0026#39;\u003c/span\u003e)),\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    (\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;KNN\u0026#39;\u003c/span\u003e, KNeighborsClassifier()),\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    (\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;RF\u0026#39;\u003c/span\u003e, RandomForestClassifier()),\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    (\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;SVM\u0026#39;\u003c/span\u003e, SVC(gamma\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;auto\u0026#39;\u003c/span\u003e))\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e]\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003efor\u003c/span\u003e name, model \u003cspan style=\"color:#f92672\"\u003ein\u003c/span\u003e models:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    kfold \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e StratifiedKFold(n_splits\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e10\u003c/span\u003e, random_state\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e, shuffle\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#66d9ef\"\u003eTrue\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    cv_results \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e cross_val_score(model, X_train, y_train, cv\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003ekfold, scoring\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;accuracy\u0026#39;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    print(\u003cspan style=\"color:#e6db74\"\u003ef\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e{\u003c/span\u003ename\u003cspan style=\"color:#e6db74\"\u003e}\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e: \u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e{\u003c/span\u003ecv_results\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003emean()\u003cspan style=\"color:#e6db74\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e.4f\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e}\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e (\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e{\u003c/span\u003ecv_results\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003estd()\u003cspan style=\"color:#e6db74\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e.4f\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e}\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e)\u0026#34;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch3 id=\"rf-optimizado-mejores-parámetros\"\u003eRF optimizado: Mejores parámetros\u003c/h3\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-python\" data-lang=\"python\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003efrom\u003c/span\u003e sklearn.model_selection \u003cspan style=\"color:#f92672\"\u003eimport\u003c/span\u003e RandomizedSearchCV\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eparam_dist \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;n_estimators\u0026#39;\u003c/span\u003e: [\u003cspan style=\"color:#ae81ff\"\u003e50\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e100\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e200\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e300\u003c/span\u003e],\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;max_depth\u0026#39;\u003c/span\u003e: [\u003cspan style=\"color:#66d9ef\"\u003eNone\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e10\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e20\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e30\u003c/span\u003e],\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;min_samples_split\u0026#39;\u003c/span\u003e: [\u003cspan style=\"color:#ae81ff\"\u003e2\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e5\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e10\u003c/span\u003e],\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;min_samples_leaf\u0026#39;\u003c/span\u003e: [\u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e2\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e4\u003c/span\u003e],\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;max_features\u0026#39;\u003c/span\u003e: [\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;sqrt\u0026#39;\u003c/span\u003e, \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;log2\u0026#39;\u003c/span\u003e]\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e}\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003erandom_search \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e RandomizedSearchCV(\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    estimator\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003eRandomForestClassifier(), \n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    param_distributions\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003eparam_dist,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    n_iter\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e50\u003c/span\u003e, cv\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e5\u003c/span\u003e, scoring\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;f1_macro\u0026#39;\u003c/span\u003e, verbose\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e2\u003c/span\u003e, n_jobs\u003cspan style=\"color:#f92672\"\u003e=-\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e, random_state\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e42\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003erandom_search\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003efit(X_train, y_train)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eprint(random_search\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003ebest_params_)\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch3 id=\"evaluación-rf-optimizado\"\u003eEvaluación RF optimizado\u003c/h3\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-python\" data-lang=\"python\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eRF \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e RandomForestClassifier(\u003cspan style=\"color:#f92672\"\u003e**\u003c/span\u003erandom_search\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003ebest_params_)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eRF\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003efit(X_train, y_train)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eRF_pred \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e RF\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003epredict(X_test)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003efrom\u003c/span\u003e sklearn.metrics \u003cspan style=\"color:#f92672\"\u003eimport\u003c/span\u003e accuracy_score, confusion_matrix, classification_report\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eprint(accuracy_score(y_test, RF_pred))\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eprint(confusion_matrix(y_test, RF_pred))\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eprint(classification_report(y_test, RF_pred))\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch3 id=\"scoring-de-abandono\"\u003eScoring de abandono\u003c/h3\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-python\" data-lang=\"python\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003edf[\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;scoring_abandono\u0026#39;\u003c/span\u003e] \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e RF\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003epredict_proba(df_ml\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003edrop(columns\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;abandono\u0026#39;\u003c/span\u003e))[:,\u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e]\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003edf\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003esort_values(by\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;scoring_abandono\u0026#39;\u003c/span\u003e, ascending\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#66d9ef\"\u003eFalse\u003c/span\u003e)\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003ehead(\u003cspan style=\"color:#ae81ff\"\u003e10\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e\u003cbr\u003e\u003cbr\u003e\u003c/p\u003e\n\u003ch2 id=\"visualización-y-comunicación\"\u003eVisualización y Comunicación\u003c/h2\u003e\n\u003cdiv style=\"text-align: center; margin: 2rem 0;\"\u003e\r\n  \u003c!-- Enlace al dashboard con estilo de botón --\u003e\r\n  \u003cp\u003e\r\n    \u003ca href=\"https://public.tableau.com/app/profile/alicia.gil.matute/viz/DashboardAbandonoEmpleados_17549150031180/Dashboard1\" \r\n       target=\"_blank\" class=\"btn-contact\"\u003e\r\n       Ver Dashboard\r\n    \u003c/a\u003e\r\n  \u003c/p\u003e\r\n\u003c!-- No es necesario porque se gestiona el tamaño en single.html --\u003e\r\n\u003c!-- Dashboard centrado manualmente\r\n\u003cdiv style=\"text-align: center; margin: 2rem 0;\"\u003e\r\n\u003cdiv style=\"width: 100%; max-width: 1200px; margin: 0 auto;\"\u003e\r\n  \u003ciframe \r\n      src=\"https://public.tableau.com/views/DashboardAbandonoEmpleados_17549150031180/Dashboard1?:showVizHome=no\u0026:embed=true\"\r\n      width=\"100%\" height=\"900\" frameborder=\"0\" scrolling=\"no\" allowfullscreen\r\n      style=\"margin: 0 auto; display: block;\"\u003e\r\n  \u003c/iframe\u003e\r\n\u003c/div\u003e --\u003e","description":"Proyecto de Business Intelligence para predecir el abandono de empleados, medir su impacto económico y proponer estrategias de retención.","image":null,"permalink":"http://localhost:1313/proyectos/fuga_empleados/","title":"Análisis Abandono de Empleados"},{"content":"\u003cp\u003e\u003cbr\u003e\u003cbr\u003e\u003c/p\u003e\n\u003cp\u003eEl trabajo de un Data Scientist en el mundo del Business Intelligence se podría resumir en 3 grandes grupos de tareas:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003cstrong\u003eGeneración de Insights\u003c/strong\u003e: analizar los datos para encontrar resultados y conclusiones que puedan tener impacto en el negocio de la empresa.\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eCreación de Informes, cuadros de mando y Dashboards\u003c/strong\u003e: permiten organizar la información relevante para la empresa, estructurándola, analizándola y presentándola en forma de resultados visualmente atractivos y fácilmente entendibles por los usuarios de negocio.\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eProyectos Ad hoc\u003c/strong\u003e: problemas concretos que preocupan en un momento dado y que pueden ser resueltos mediante análisis de datos.\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eEste proyecto contiene casos de los 3 tipos de tareas típicas de un Data Scientist con diferentes herramientas: SQL, PowerBI, Python.\n\u003cbr\u003e\u003cbr\u003e\u003c/p\u003e\n\u003cdiv style=\"display:flex; justify-content:center; gap:30px; align-items:flex-start;\"\u003e\r\n  \u003cfigure style=\"margin:0; width:500px; text-align:center;\"\u003e\r\n    \u003cimg src=\"/ecommerce_hoja1.png\" alt=\"Dashboard de Ventas del Último Año\" width=\"800\" height=\"280\"\u003e\r\n    \u003cfigcaption style=\"font-style:italic; margin-top:8px;\"\u003e\r\n      Dashboard de Ventas del Último Año\r\n    \u003c/figcaption\u003e\r\n  \u003c/figure\u003e\r\n  \u003cfigure style=\"margin:0; width:500px; text-align:center;\"\u003e\r\n    \u003cimg src=\"/ecommerce_hoja2.png\" alt=\"Aplicación del Algoritmo del recomendador (Market Basket Analysis)\" width=\"800\" height=\"280\"\u003e\r\n    \u003cfigcaption style=\"font-style:italic; margin-top:8px;\"\u003e\r\n      Aplicación del Algoritmo del recomendador (Market Basket Analysis)\r\n    \u003c/figcaption\u003e\r\n  \u003c/figure\u003e\r\n\u003c/div\u003e\r\n\u003cbr\u003e\u003cbr\u003e\r\n\u003ch2 id=\"contexto\"\u003eContexto\u003c/h2\u003e\n\u003cp\u003eTrabajamos para una Ecommerce que vende productos frescos y saludables. Es una startup llamada ‘SanoyFresco’ que estaba creciendo mucho, pero por algún motivo en el último año ha empezado a perder muchas ventas. Y por eso han decidido invertir en contratar a analistas de datos para empezar a tomar las decisiones de una manera más profesional basándose en datos.\u003c/p\u003e\n\u003cp\u003eLo primero que vas a hacer es analizar datos para entender cómo está la situación de las ventas. Es algo que el director general suele pedir para presentarlo en el Consejo de Administración.\u003c/p\u003e\n\u003cp\u003eDespués vas a crear un cuadro de mando para solucionar el primer problema urgente de la empresa que es la falta de una fuente de información única. Cada director de cada departamento lleva a las reuniones sus propios datos y al final es imposible ponerse de acuerdo y tomar decisiones basándose en datos. Pondremos orden en toda esta información y crearemos la fuente única de la verdad en cuanto a datos que será utilizada en la empresa a partir de ahora.\u003c/p\u003e\n\u003cp\u003eTras ello nos piden que ayudemos en la parte de intentar remontar las ventas. Y para ello vamos a crear un algoritmo en Python que analice el histórico de las compras y localice patrones consistentes en los datos que nos permiten incrementar las futuras ventas. Del estilo de: ‘si el cliente ha comprado esto, entonces también tiene muy alta probabilidad de estar interesado en esto otro’, y por lo tanto se lo vamos a recomendar en el recomendador de la página del Ecommerce. Esto va a ayudar a aumentar el ‘Ticket Medio de Compra’.\u003c/p\u003e\n\u003cp\u003eY, por último, le daremos al usuario de negocio una interfaz gráfica y amigable con la que interactuar con el algoritmo que has construido. El usuario de negocio no conoce Python y no va a saber trabajar a partir del código que tú escribas, así que crearemos una especie de aplicación en PowerBI para que él pueda acceder a esas reglas, a esos patrones, identificados por el algoritmo de una manera totalmente visual y no técnica.\u003c/p\u003e\n\u003cp\u003e\u003cbr\u003e\u003cbr\u003e\u003c/p\u003e\n\u003ch2 id=\"1-generación-de-insights-con-sql\"\u003e1. Generación de Insights con SQL\u003c/h2\u003e\n\u003cbr\u003e\r\n\u003ch3 id=\"objetivos\"\u003eObjetivos\u003c/h3\u003e\n\u003cp\u003eGenerar Insights del negocio para presentar en el Consejo de Administración\n\u003cbr\u003e\u003cbr\u003e\u003c/p\u003e\n\u003ch3 id=\"instrucciones\"\u003eInstrucciones\u003c/h3\u003e\n\u003cp\u003eLo haremos directamente contra la base de datos, sin extraer información dado que solo necesitamos unos datos puntuales. Usaremos SQL y son consultas muy sencillas.\u003c/p\u003e\n\u003cp\u003eUtilizaremos el \u003cem\u003eframework\u003c/em\u003e de la pirámide que nos sirva como guía para decidir qué preguntas, es decir qué consultas, queremos extraer de la base de datos. Son mapas de ruta muy útiles que nos permiten separar el grano de la paja ante tanto dato para dar respuesta a lo que nos interesa saber.\u003c/p\u003e\n\u003cbr\u003e\r\n\u003cdiv style=\"display:flex; justify-content:center; gap:30px; align-items:center;\"\u003e\r\n  \u003cfigure style=\"margin:0; width:360px; text-align:center;\"\u003e\r\n    \u003cimg src=\"/piramide_framework.png\" alt=\"Framework de la Pirámide\" width=\"360\"\u003e\r\n    \u003cfigcaption style=\"font-style:italic; margin-top:8px;\"\u003e\r\n      Figura 1. Framework de la Pirámide.\r\n    \u003c/figcaption\u003e\r\n  \u003c/figure\u003e\r\n\u003c/div\u003e\r\n\u003cbr\u003e\u003cbr\u003e\r\n\u003ch3 id=\"diseño-analítico\"\u003eDiseño Analítico\u003c/h3\u003e\n\u003cp\u003ePara realizar un análisis integral del negocio es importante seguir un enfoque estructurado que vaya de lo general a lo específico. Comenzaremos con una visión general de las ventas totales, luego analizaremos la tendencia de las mismas, profundizaremos en los productos y finalmente examinaremos el comportamiento de los clientes y de los pedidos.\u003c/p\u003e\n\u003cp\u003eDaremos respuesta acerca de la situación de las \u0026lsquo;Ventas y tendencia\u0026rsquo;, los \u0026lsquo;Productos y secciones\u0026rsquo; y los \u0026lsquo;Clientes y pedidos\u0026rsquo; mediante las siguientes preguntas:\n\u003cbr\u003e\u003cbr\u003e\u003c/p\u003e\n\u003cp\u003ePregunta 0: ¿Qué datos contiene la tabla a analizar?\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eVENTAS Y TENDENCIA\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003ePregunta 1: ¿Cuál es el ingreso total generado por el negocio?\u003c/p\u003e\n\u003cp\u003ePregunta 2: ¿Cómo ha sido la tendencia de ingresos mensuales?\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003ePRODUCTOS Y SECCIONES\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003ePregunta 3: ¿Cuál es el rendimiento de cada departamento en términos de ventas?\u003c/p\u003e\n\u003cp\u003ePregunta 4: ¿Cómo se distribuyen las ventas entre las diferentes secciones?\u003c/p\u003e\n\u003cp\u003ePregunta 5: ¿Cuáles son los 10 productos más vendidos en cantidad?\u003c/p\u003e\n\u003cp\u003ePregunta 6: ¿Qué 10 productos generan más ingresos?\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eCLIENTES Y PEDIDOS\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003ePregunta 7: ¿Quiénes son los 20 clientes que más compran en términos de ingresos?\u003c/p\u003e\n\u003cp\u003ePregunta 8: ¿Cuál es la compra media por cliente?\u003c/p\u003e\n\u003cp\u003ePregunta 9: ¿Cuántos pedidos totales se han realizado?\u003c/p\u003e\n\u003cp\u003ePregunta 10: ¿Cuál es el valor promedio por pedido?\u003c/p\u003e\n\u003cp\u003e\u003cbr\u003e\u003cbr\u003e\u003c/p\u003e\n\u003ch3 id=\"desarrollo\"\u003eDesarrollo\u003c/h3\u003e\n\u003cp\u003eY con estas consultas SQL damos respuesta a esas preguntas:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-sql\" data-lang=\"sql\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e-- 0 PREGUNTA\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003eSELECT\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e*\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003eFROM\u003c/span\u003e tickets \u003cspan style=\"color:#66d9ef\"\u003eLIMIT\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e100\u003c/span\u003e;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e--1 PREGUNTA\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e\u003cspan style=\"color:#66d9ef\"\u003eSELECT\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003eSUM\u003c/span\u003e(precio_total) \u003cspan style=\"color:#66d9ef\"\u003eAS\u003c/span\u003e ingreso_total \u003cspan style=\"color:#66d9ef\"\u003eFROM\u003c/span\u003e tickets;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e-- 2 PREGUNTA\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e\u003cspan style=\"color:#66d9ef\"\u003eSELECT\u003c/span\u003e strftime(\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;%Y-%m\u0026#39;\u003c/span\u003e, fecha) \u003cspan style=\"color:#66d9ef\"\u003eAS\u003c/span\u003e mes, \u003cspan style=\"color:#66d9ef\"\u003eSUM\u003c/span\u003e (precio_total) \u003cspan style=\"color:#66d9ef\"\u003eAS\u003c/span\u003e ingreso_meansual \n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003efrom\u003c/span\u003e tickets\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003eGROUP\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003eBY\u003c/span\u003e mes\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003eORDER\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003eBY\u003c/span\u003e mes;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e-- 3 PREGUNTA\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003eSELECT\u003c/span\u003e id_departamento, \u003cspan style=\"color:#66d9ef\"\u003eSUM\u003c/span\u003e(precio_total) \u003cspan style=\"color:#66d9ef\"\u003eAS\u003c/span\u003e ventas_departamento \u003cspan style=\"color:#66d9ef\"\u003eFROM\u003c/span\u003e tickets \n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003eGROUP\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003eBY\u003c/span\u003e id_departamento\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003eORDER\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003eBY\u003c/span\u003e ventas_departamento \u003cspan style=\"color:#66d9ef\"\u003eDESC\u003c/span\u003e;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e-- 4 PREGUNTA\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003eSELECT\u003c/span\u003e id_seccion, \u003cspan style=\"color:#66d9ef\"\u003eSUM\u003c/span\u003e(precio_total) \u003cspan style=\"color:#66d9ef\"\u003eAS\u003c/span\u003e ventas_seccion \u003cspan style=\"color:#66d9ef\"\u003eFROM\u003c/span\u003e tickets\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003eGROUP\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003eBY\u003c/span\u003e id_seccion\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003eORDER\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003eBY\u003c/span\u003e ventas_seccion \u003cspan style=\"color:#66d9ef\"\u003eDESC\u003c/span\u003e;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e-- 5 PREGUNTA \n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e\u003cspan style=\"color:#66d9ef\"\u003eSELECT\u003c/span\u003e nombre_producto, \u003cspan style=\"color:#66d9ef\"\u003eSUM\u003c/span\u003e(cantidad) \u003cspan style=\"color:#66d9ef\"\u003eAS\u003c/span\u003e top10_cantidad \u003cspan style=\"color:#66d9ef\"\u003eFROM\u003c/span\u003e tickets\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003eGROUP\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003eBY\u003c/span\u003e nombre_producto\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003eORDER\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003eBY\u003c/span\u003e top10_cantidad \u003cspan style=\"color:#66d9ef\"\u003eDESC\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003eLIMIT\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e10\u003c/span\u003e;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e-- 6 PREGUNTA\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003eSELECT\u003c/span\u003e nombre_producto, \u003cspan style=\"color:#66d9ef\"\u003eSUM\u003c/span\u003e(precio_total) \u003cspan style=\"color:#66d9ef\"\u003eAS\u003c/span\u003e top10_ingresos \u003cspan style=\"color:#66d9ef\"\u003eFROM\u003c/span\u003e tickets\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003eGROUP\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003eBY\u003c/span\u003e nombre_producto\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003eORDER\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003eBY\u003c/span\u003e top10_ingresos \u003cspan style=\"color:#66d9ef\"\u003eDESC\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003eLIMIT\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e10\u003c/span\u003e;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e-- 7 PREGUNTA\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e\u003cspan style=\"color:#66d9ef\"\u003eSELECT\u003c/span\u003e id_cliente, \u003cspan style=\"color:#66d9ef\"\u003eSUM\u003c/span\u003e(precio_total) \u003cspan style=\"color:#66d9ef\"\u003eAS\u003c/span\u003e top20_clientes \u003cspan style=\"color:#66d9ef\"\u003eFROM\u003c/span\u003e tickets\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003eGROUP\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003eBY\u003c/span\u003e id_cliente\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003eORDER\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003eBY\u003c/span\u003e top20_clientes \u003cspan style=\"color:#66d9ef\"\u003eDESC\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003eLIMIT\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e20\u003c/span\u003e;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e-- 8 PREGUNTA\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e\u003cspan style=\"color:#66d9ef\"\u003eSELECT\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003eAVG\u003c/span\u003e (compra_total_cliente) \u003cspan style=\"color:#66d9ef\"\u003eAS\u003c/span\u003e compra_media_cliente\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003eFROM\u003c/span\u003e(\u003cspan style=\"color:#66d9ef\"\u003eSELECT\u003c/span\u003e id_cliente, \u003cspan style=\"color:#66d9ef\"\u003eSUM\u003c/span\u003e(precio_total) \u003cspan style=\"color:#66d9ef\"\u003eAS\u003c/span\u003e compra_total_cliente \n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e     \u003cspan style=\"color:#66d9ef\"\u003eFROM\u003c/span\u003e tickets\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e     \u003cspan style=\"color:#66d9ef\"\u003eGROUP\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003eBY\u003c/span\u003e id_cliente) subconsulta;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e-- 9 PREGUNTA\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e\u003cspan style=\"color:#66d9ef\"\u003eSELECT\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003eCOUNT\u003c/span\u003e(\u003cspan style=\"color:#66d9ef\"\u003eDISTINCT\u003c/span\u003e (id_pedido)) \u003cspan style=\"color:#66d9ef\"\u003eAS\u003c/span\u003e total_pedidos \u003cspan style=\"color:#66d9ef\"\u003efrom\u003c/span\u003e tickets;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e-- 10 PREGUNTA\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e\u003cspan style=\"color:#66d9ef\"\u003eSELECT\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003eAVG\u003c/span\u003e (precio_total_pedido) \u003cspan style=\"color:#66d9ef\"\u003eAS\u003c/span\u003e media_pedido\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003eFROM\u003c/span\u003e(\u003cspan style=\"color:#66d9ef\"\u003eSELECT\u003c/span\u003e id_pedido, \u003cspan style=\"color:#66d9ef\"\u003eSUM\u003c/span\u003e(precio_total) \u003cspan style=\"color:#66d9ef\"\u003eAS\u003c/span\u003e precio_total_pedido \n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e     \u003cspan style=\"color:#66d9ef\"\u003efrom\u003c/span\u003e tickets\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003eGROUP\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003eBY\u003c/span\u003e id_pedido)subconsulta;\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c!-- resultados jupyer-book?? --\u003e\r\n\u003cp\u003e\u003cbr\u003e\u003cbr\u003e\u003c/p\u003e\n\u003ch3 id=\"conclusiones\"\u003eConclusiones\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003eLa disminución de las ventas se debe a la pérdida de clientes. Pero los clientes que se quedan compran más.\u003c/li\u003e\n\u003cli\u003eAumento del ticket medio por cliente y por pedido.\u003c/li\u003e\n\u003c/ul\u003e\n\u003c!-- - *Informe* --\u003e\r\n\u003cbr\u003e\r\n\u003cblockquote\u003e\n\u003cp\u003e💡 \u003cstrong\u003eTIP\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003eEl trabajo del analista de datos sigue la estrategia:\nAnálisis de datos → Evidencias → Insights\u003c/p\u003e\n\u003cp\u003eSin embargo, al comunicar los resultados a personal no especializado, el \u003cem\u003eframework\u003c/em\u003e de la pirámide recomienda presentarlo en orden inverso:\nInsights → Evidencias → Análisis de datos\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003chr\u003e\n\u003cbr\u003e\r\n\u003ch2 id=\"2-creando-un-algoritmo-con-python\"\u003e2. Creando un Algoritmo con Python\u003c/h2\u003e\n\u003cbr\u003e\r\n\u003ch3 id=\"objetivos-1\"\u003eObjetivos\u003c/h3\u003e\n\u003cp\u003eA largo plazo: trabajar en la adquisición y fidelización de clientes.\u003c/p\u003e\n\u003cp\u003eA corto plazo: incrementar las ventas.\u003c/p\u003e\n\u003cbr\u003e\r\n\u003ch3 id=\"instrucciones-1\"\u003eInstrucciones\u003c/h3\u003e\n\u003cp\u003eCrear un algoritmo de Python que permita vender más productos en cada transacción. El algoritmo estará basado en la técnica \u003cem\u003e‘Market Basket Analysis’\u003c/em\u003e.\u003c/p\u003e\n\u003cbr\u003e\r\n\u003ch3 id=\"diseño-analítico-1\"\u003eDiseño Analítico\u003c/h3\u003e\n\u003cp\u003e\u003cem\u003e‘Market Basket Analysis’\u003c/em\u003e: metodología muy usada en todo tipo de empresas para hacer recomendaciones personalizadas a cada usuario en base a lo que ya ha comprado o en lo que tiene interés.\u003c/p\u003e\n\u003cp\u003eConceptos clave:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003cstrong\u003eAntecedente (A)\u003c/strong\u003e: el “si…”. Conjunto de ítems en el lado izquierdo de la regla. Ej.: A = {manzana}.\u003cbr\u003e\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eConsecuente (B)\u003c/strong\u003e: el “entonces…”. Conjunto de ítems en el lado derecho. Ej.: B = {plátano}.\u003cbr\u003e\u003cbr\u003e\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eSoporte\u003c/strong\u003e: qué probabilidad hay de que manzana y plátano aparezcan juntos en una transacción. Así que simplemente dividimos la frecuencia por el número de todas las transacciones.\u003cbr\u003e\u003cbr\u003e\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eConfianza\u003c/strong\u003e: probabilidad de ver B dado que aparece A. En nuestro ejemplo esto significa: ¿Qué probabilidad hay de que, si la manzana está en la cesta, entonces plátano también lo esté? Podemos calcularlo dividiendo la frecuencia de la manzana y el plátano por la frecuencia de la manzana.\u003cbr\u003e\u003cbr\u003e\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eLift\u003c/strong\u003e: el lift indica la intensidad por el cual la probabilidad de comprar los productos consecuentes aumenta si los productos antecedentes ya han sido comprados. Así, en nuestro ejemplo, si el producto manzana está en la cesta de la compra, es 1.27 veces más probable que se compre plátano que si el producto manzana no está en la cesta.\u003cbr\u003e\u003cbr\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eMás información sobre la técnica \u003cem\u003e‘Market Basket Analysis’\u003c/em\u003e:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://datatab.es/tutorial/market-basket-analysis\"\u003ehttps://datatab.es/tutorial/market-basket-analysis\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://iasolver.es/todo-sobre-el-market-basket-analysis-y-su-utilidad-en-el-sector-minorista-y-retail\"\u003ehttps://iasolver.es/todo-sobre-el-market-basket-analysis-y-su-utilidad-en-el-sector-minorista-y-retail\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003cbr\u003e\u003cbr\u003e\u003c/p\u003e\n\u003ch3 id=\"desarrollo-1\"\u003eDesarrollo\u003c/h3\u003e\n\u003cp\u003eA continuación, vamos a aplicar la lógica explicada del \u003cem\u003e\u0026lsquo;Market Basker Analysis\u0026rsquo;\u003c/em\u003e en el siguiente código de Python usando la base de datos con la que hemos hecho las consultas SQL:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-python\" data-lang=\"python\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003eimport\u003c/span\u003e sqlite3\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003eimport\u003c/span\u003e pandas \u003cspan style=\"color:#66d9ef\"\u003eas\u003c/span\u003e pd\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003econexion\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003esqlite3\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003econnect(\u003cspan style=\"color:#e6db74\"\u003er\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;C:\\Users\\alici\\Desktop\\Programación\\Data4Business\\Experiencia Junior\\sanoyfresco.db\u0026#34;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003edf\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003epd\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eread_sql_query(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;SELECT * FROM tickets\u0026#34;\u003c/span\u003e,conexion)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003edf\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003ehead()\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003econexion\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eclose()\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003edf\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003einfo()\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003edf[\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;fecha\u0026#39;\u003c/span\u003e]\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003epd\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eto_datetime(df[\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;fecha\u0026#39;\u003c/span\u003e])\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003edf_cesta\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003edf[[\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;id_pedido\u0026#39;\u003c/span\u003e,\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;nombre_producto\u0026#39;\u003c/span\u003e]]\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003edf_cesta\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003ehead()\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e# Agrupar los productos por id_pedido e incluir en una misma celda el nombre de todos los productos del pedido\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003edf_agrupado\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003edf_cesta\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003egroupby(\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;id_pedido\u0026#39;\u003c/span\u003e)[\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;nombre_producto\u0026#39;\u003c/span\u003e]\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eapply(\u003cspan style=\"color:#66d9ef\"\u003elambda\u003c/span\u003e producto: \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;,\u0026#39;\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003ejoin(producto))\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003edf_agrupado\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003ehead()\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e# Aplicar pd.get_dummies() para transformar los productos en columnas con 0/1\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003edf_transacciones\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003edf_agrupado\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003estr\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eget_dummies(sep\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;,\u0026#34;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003edf_transacciones\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003ehead()\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e#**IMPORTANTE** Recordemos que vamos a calcular el soporte individual del antecedente lo cual se define como la suma de las veces que se ha comprado el producto entre el total de los pedidos. Pero al haber convertido los datos en dummies (1/0), la suma de los 1 se corresponde con la media (truco matemático). Con lo cual, pasamos directamente a calcular la media.\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003esoporte\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003edf_transacciones\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003emean()\u003cspan style=\"color:#f92672\"\u003e*\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e100\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003esoporte\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003esort_values(ascending\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#66d9ef\"\u003eFalse\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e# Función para calcular la confianza entre dos productos en la muestra\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003edef\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003econfianza\u003c/span\u003e(antecedente, consecuente):\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#75715e\"\u003e# Casos donde se compraron ambos productos\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    conjunto_ac \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e df_transacciones[(df_transacciones[antecedente] \u003cspan style=\"color:#f92672\"\u003e==\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e) \u003cspan style=\"color:#f92672\"\u003e\u0026amp;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e                                   (df_transacciones[consecuente] \u003cspan style=\"color:#f92672\"\u003e==\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e)]\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#75715e\"\u003e# Confianza = compras conjuntas / compras de producto A\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003ereturn\u003c/span\u003e len(conjunto_ac) \u003cspan style=\"color:#f92672\"\u003e/\u003c/span\u003e df_transacciones[antecedente]\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003esum()\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e# Función para calcular el lift entre dos productos en la muestra\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003edef\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003elift\u003c/span\u003e(antecedente, consecuente):\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    soporte_a \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e df_transacciones[antecedente]\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003emean()\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    soporte_c \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e df_transacciones[consecuente]\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003emean()\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    conteo_ac \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e len(df_transacciones[(df_transacciones[antecedente] \u003cspan style=\"color:#f92672\"\u003e==\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e) \u003cspan style=\"color:#f92672\"\u003e\u0026amp;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e                                   (df_transacciones[consecuente] \u003cspan style=\"color:#f92672\"\u003e==\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e)])\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    soporte_ac \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e conteo_ac \u003cspan style=\"color:#f92672\"\u003e/\u003c/span\u003e len(df_transacciones)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003ereturn\u003c/span\u003e soporte_ac \u003cspan style=\"color:#f92672\"\u003e/\u003c/span\u003e (soporte_a \u003cspan style=\"color:#f92672\"\u003e*\u003c/span\u003e soporte_c)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003efrom\u003c/span\u003e itertools \u003cspan style=\"color:#f92672\"\u003eimport\u003c/span\u003e combinations\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e# Definir un umbral para la confianza mínima\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eumbral_confianza \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e0.05\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003easociaciones \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e []\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e# Generar combinaciones de productos y calcular confianza y lift\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003efor\u003c/span\u003e antecedente, consecuente \u003cspan style=\"color:#f92672\"\u003ein\u003c/span\u003e combinations(df_transacciones\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003ecolumns, \u003cspan style=\"color:#ae81ff\"\u003e2\u003c/span\u003e):\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#75715e\"\u003e# Soporte del antecedente\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    soporte_a \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e df_transacciones[antecedente]\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003emean()\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#75715e\"\u003e# Calcular confianza\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    conf \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e confianza(antecedente, consecuente)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e conf \u003cspan style=\"color:#f92672\"\u003e\u0026gt;\u003c/span\u003e umbral_confianza:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        asociaciones\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eappend({\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;antecedente\u0026#39;\u003c/span\u003e: antecedente,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;consecuente\u0026#39;\u003c/span\u003e: consecuente,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;soporte_a\u0026#39;\u003c/span\u003e: round(soporte_a \u003cspan style=\"color:#f92672\"\u003e*\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e100\u003c/span\u003e,\u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e),\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;confianza\u0026#39;\u003c/span\u003e: round(conf \u003cspan style=\"color:#f92672\"\u003e*\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e100\u003c/span\u003e,\u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e),\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;lift\u0026#39;\u003c/span\u003e: round(lift(antecedente, consecuente),\u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        })\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e# Convertir las asociaciones en un DataFrame\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003edf_asociaciones \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e pd\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eDataFrame(asociaciones)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e# Ordenar las asociaciones por confianza de mayor a menor\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003edf_asociaciones\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003esort_values(by\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;lift\u0026#39;\u003c/span\u003e, ascending\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#66d9ef\"\u003eFalse\u003c/span\u003e, inplace\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#66d9ef\"\u003eTrue\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003edf_asociaciones\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e# El bucle ha generado 399 reglas (399 combinaciones). Ahora le toca decidir al usuario cliente cuales son las reglas que nos merece la pena poner nuestros esfuerzos en base al lift: todas aquellas que contengan un lift superior a 1, a 1.5, a 2, etc...\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e# Generamos una tabla de los productos únicos con su \u0026#39;id_producto\u0026#39;, \u0026#39;id_seccion\u0026#39;, \u0026#39;id_departamento\u0026#39; para enriquecer la tabla de reglas\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eproductos_unicos\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003edf[[\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;id_producto\u0026#39;\u003c/span\u003e,\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;id_seccion\u0026#39;\u003c/span\u003e,\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;id_departamento\u0026#39;\u003c/span\u003e,\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;nombre_producto\u0026#39;\u003c/span\u003e]]\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003edrop_duplicates()\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eproductos_unicos\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003ehead()\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e# Unimos la tabla del algortimo con la tabla de los productos unicos\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003edf_asociaciones_enriquecido\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003edf_asociaciones\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003emerge(productos_unicos,left_on\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;antecedente\u0026#39;\u003c/span\u003e,right_on\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;nombre_producto\u0026#39;\u003c/span\u003e,how\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;left\u0026#39;\u003c/span\u003e)\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003edrop(columns\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e[\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;nombre_producto\u0026#39;\u003c/span\u003e])\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003edf_asociaciones_enriquecido\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003ecolumns\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e[\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;antecedente\u0026#39;\u003c/span\u003e,\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;consecuente\u0026#39;\u003c/span\u003e,\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;soporte_a\u0026#39;\u003c/span\u003e,\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;confianza\u0026#39;\u003c/span\u003e,\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;lift\u0026#39;\u003c/span\u003e,\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;id_producto_a\u0026#39;\u003c/span\u003e,\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;id_seccion_a\u0026#39;\u003c/span\u003e,\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;id_departamento_a\u0026#39;\u003c/span\u003e]\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003edf_asociaciones_enriquecido\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003ehead()\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003edf_asociaciones_enriquecido\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003eto_csv(\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;reglas.csv\u0026#39;\u003c/span\u003e, index\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#66d9ef\"\u003eFalse\u003c/span\u003e, sep\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;;\u0026#39;\u003c/span\u003e, decimal\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;,\u0026#39;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e\u003cbr\u003e\u003cbr\u003e\u003c/p\u003e\n\u003ch3 id=\"conclusiones-1\"\u003eConclusiones\u003c/h3\u003e\n\u003c!-- *umbral del lift?: reglas* --\u003e\r\n\u003cp\u003eCon estas reglas entramos en la fase del trabajo donde debemos colaborar con otros departamentos de la empresa para explotar las reglas generadas. Ejemplos:\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eDepartamento IT\u003c/strong\u003e: podemos pasarle estas reglas directamente al departamento de informática para que las implementen en el recomendador de la página web.\n\u003cbr\u003e\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eDepartamento Marketing/Negocio\u003c/strong\u003e:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eImplementar las reglas no solo en el recomendador del producto concreto, también en el checkout de compra.\u003cbr\u003e\u003cbr\u003e\u003c/li\u003e\n\u003cli\u003eUsar el historial de compras de los clientes y meter esos productos como input en nuestra tabla de reglas, con la intención de ofrecer directamente al cliente los productos del output a través de newsletter/email personalizado.\u003cbr\u003e\u003cbr\u003e\u003c/li\u003e\n\u003cli\u003eSe podrían desarrollar nuevos productos: cestas y packs siguiendo las reglas con los productos que se compran frecuentemente juntos. Así a lo mejor, el cliente en vez de gastarse 5 euros en el producto individual decide optar por una cesta de 15 euros donde aparezca ese producto y otros, aumentando así el Ticket Medio de Compra. \u003cbr\u003e\u003cbr\u003e\u003c/li\u003e\n\u003cli\u003eLas reglas también permiten la generación de cupones personalizados por cliente. No tiene sentido enviar a todos los clientes los mismos cupones con las mismas ofertas cuando tenemos información sobre el historial de compra de cada cliente. \u003cbr\u003e\u003c/li\u003e\n\u003cli\u003eEtc.\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003cbr\u003e\u003cbr\u003e\u003c/p\u003e\n\u003ch2 id=\"3-creación-de-cuadros-de-mando-con-powerbi\"\u003e3. Creación de Cuadros de Mando con PowerBI\u003c/h2\u003e\n\u003cbr\u003e\r\n\u003ch3 id=\"objetivos-2\"\u003eObjetivos\u003c/h3\u003e\n\u003cp\u003eEl dashboard se comprondrá de dos hojas: en la primera hoja se incluirán gráficos y paneles que muestren la información relevante de las ventas en el último año, la fuente única de los datos; en la segunda hoja se incluirá la aplicación de \u003cem\u003e‘Market Basket Analysis’\u003c/em\u003e de nuestro algoritmo en Python.\u003c/p\u003e\n\u003cp\u003e\u003cu\u003eHoja 1\u003c/u\u003e:\nCreación de la fuente única de los datos sobre las ventas para tomar acciones sobre ellos y que será común a todos los departamentos. Realizarlo en una herramienta profesional, como PowerBI.\u003c/p\u003e\n\u003cp\u003e\u003cu\u003eHoja 2\u003c/u\u003e:\nCrear un dashboard a modo de aplicación que contenga las reglas obtenidas con nuestro algoritmo de Python, y mediante filtros poder identificar los componentes de la técnica de \u003cem\u003e‘Market Basket Analysis’\u003c/em\u003e (confianza, lift, antecedente, etc.) para cada sección y productos.\n\u003cbr\u003e\u003cbr\u003e\u003c/p\u003e\n\u003ch3 id=\"instrucciones-2\"\u003eInstrucciones\u003c/h3\u003e\n\u003cp\u003e\u003cstrong\u003eHoja 1 y Hoja 2\u003c/strong\u003e: Documento de Requerimientos Funcionales del Negocio.\n\u003cbr\u003e\u003cbr\u003e\u003c/p\u003e\n\u003ch3 id=\"diseño-analítico-2\"\u003eDiseño Analítico\u003c/h3\u003e\n\u003cp\u003e\u003cem\u003eMockup\u003c/em\u003e: a gusto personal siempre que contenga los contenidos exigidos en el documento de Requerimientos (se ofrece una versión en el Documento de Requerimientos).\n\u003cbr\u003e\u003cbr\u003e\u003c/p\u003e\n\u003ch3 id=\"desarrollo-2\"\u003eDesarrollo\u003c/h3\u003e\n\u003cdiv style=\"text-align: center; margin: 2rem 0;\"\u003e\r\n  \u003c!-- Enlace al dashboard con estilo de botón --\u003e\r\n  \u003ciframe title=\"desarrollo\" width=\"900\" height=\"600\" src=\"https://app.powerbi.com/view?r=eyJrIjoiODQ4MWZkNTEtZmZlYi00MWNmLThlNzEtNWYwYTMwNmYzNzkxIiwidCI6ImZjNjYwMmVmLThlODgtNGYxZC1hMjA2LWUxNGEzYmMxOWFmMiIsImMiOjh9\" frameborder=\"0\" allowFullScreen=\"true\"\u003e\u003c/iframe\u003e\r\n  \u003cp\u003e\u003cbr\u003e\r\n    \u003ca href=\"https://app.powerbi.com/view?r=eyJrIjoiODQ4MWZkNTEtZmZlYi00MWNmLThlNzEtNWYwYTMwNmYzNzkxIiwidCI6ImZjNjYwMmVmLThlODgtNGYxZC1hMjA2LWUxNGEzYmMxOWFmMiIsImMiOjh9\" \r\n       target=\"_blank\" class=\"btn-contact\"\u003e\r\n       Ver Dashboard\r\n    \u003c/a\u003e\r\n  \u003c/p\u003e\r\n\u003c/div\u003e\r\n\u003ch3 id=\"conclusiones-2\"\u003eConclusiones\u003c/h3\u003e\n\u003cp\u003e\u003cbr\u003e\u003cbr\u003e\u003c/p\u003e\n","description":"Incremento en las ventas de 'SanoyFresco' al crear un recomendador online basado en la técnica 'Market Basket Analysis'","image":null,"permalink":"http://localhost:1313/proyectos/ecommerce/","title":"Análisis de Ventas Ecommerce"},{"content":"\u003cp\u003eMi timeline de Twitter (me niego a llamarlo X) es tan diversa que nada de lo humano le es ajeno, pero podría decirse que, en su mayoría, me muestra cuentas y perfiles relacionados con la estadística y la investigación científica. Hace unos días me encontré con el siguiente post:\n\u003cbr\u003e\u003cbr\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://x.com/JesslovesMJK/status/1913104932552442287\"\u003e\u003cimg src=\"/grafico.png\" alt=\"Tweet de Jessica Rose\"\u003e\u003c/a\u003e\n\u003cbr\u003e\u003cbr\u003e\u003c/p\u003e\n\u003cp\u003eCualquiera que esté crónicamente en internet como yo, sabe que si un tweet recibe tantas interacciones es que algo pasa. Y normalmente, ese “algo” tiene que ver con polémica. Quien esté familiarizado con la creación e interpretación de gráficos probablemente haya notado otra cosa en primer lugar: ese número enorme en la imagen mostrando una correlación altísima (R = 0.9021).\u003c/p\u003e\n\u003cp\u003eSin embargo, en mi caso, la sorpresa fue aún mayor cuando me fijé en las variables que se presentan como relacionadas: \u003cstrong\u003e“Número acumulado de dosis de vacunas en el mercado” vs. “Prevalencia de casos de autismo”.\u003c/strong\u003e\n\u003cbr\u003e\u003cbr\u003e\u003cbr\u003e\u003c/p\u003e\n\u003ch2 id=\"agent-cooper-its-happening-again-vacunas-y-autismo\"\u003eAgent Cooper… it’s happening again: Vacunas y autismo\u003c/h2\u003e\n\u003cbr\u003e\r\nA lo mejor al lector le suena haber escuchado algo similar a finales del siglo pasado, cuando aparecieron “estudios científicos” que afirmaban haber descubierto la causa del autismo: las vacunas. \r\n\u003cbr\u003e\u003cbr\u003e\r\n\u003cp\u003ePor si a alguien todavía le quedaba alguna duda: esa “teoría” ya fue desmentida hace años, el estudio que lo afirmaba fue retractado y su autor quedó desacreditado. Fue un escándalo enorme en la comunidad científica. Pero de eso no vamos a hablar hoy.\u003c/p\u003e\n\u003cp\u003eAun así, ese gráfico parece mostrar lo contrario en pleno 2025.\u003c/p\u003e\n\u003cp\u003e¿Por qué parece que puede ser una nueva prueba a favor de que las vacunas sí provocan autismo?, ¿Se equivocó la comunidad científica en su momento?, ¿Estamos poniendo en riesgo a nuestros niños?\u003c/p\u003e\n\u003cp\u003eNada de eso. Y quizá la mención a Donald Trump en el tweet sea menos inocente de lo que parece.\u003c/p\u003e\n\u003cp\u003ePero antes de llegar a eso, aclaremos un par de cosas:\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e\u003cstrong\u003eEL AUTISMO NO ES UNA ENFERMEDAD.\u003c/strong\u003e\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eLas correlaciones no implican causalidad, porque existen las correlaciones espurias.\u003c/strong\u003e\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003ePara poder entender qué es una correlación espuria, primero hay que explicar qué es una correlación.\n\u003cbr\u003e\u003cbr\u003e\u003cbr\u003e\u003c/p\u003e\n\u003ch2 id=\"correlación-seguro-que-no-es-otro-tipo-de-relación-abierta\"\u003e¿Correlación? ¿Seguro que no es otro tipo de relación abierta?\u003c/h2\u003e\n\u003cbr\u003e\r\n\u003cp\u003ePodría serlo, pero no. Una correlación es un índice matemático que informa sobre la relación estadística entre dos fenómenos.\u003c/p\u003e\n\u003cp\u003ePor ejemplo, hay estudios que reportan la existencia de correlación entre la puntuación en tests de CI y el nivel socioeconómico.\nUna correlación puede tomar valores entre -1 y +1, siendo 0 indicativo de ausencia de relación. Cuanto más se acerca a -1 o +1, más fuerte es la correlación. El signo indica el sentido: una correlación negativa significa que la relación es inversa, mientras que una positiva indica una relación directa.\u003c/p\u003e\n\u003cp\u003eUn ejemplo de correlación inversa es el que existe entre el consumo de tabaco y la capacidad respiratoria: a mayor consumo, menor capacidad. En el caso del CI y el nivel socioeconómico, la relación suele ser directa: a mayor nivel socioeconómico, mayor probabilidad de tener un CI elevado (o viceversa).\u003c/p\u003e\n\u003cp\u003eEsto es \u003cstrong\u003eIMPORTANTE\u003c/strong\u003e: la correlación es bidireccional, la causalidad no. Y aquí es donde ocurre la magia (o el desastre, depende del caso).\n\u003cbr\u003e\u003cbr\u003e\u003cbr\u003e\u003c/p\u003e\n\u003ch2 id=\"se-dice-causalidad-no-casualidad\"\u003eSe dice causalidad, no casualidad\u003c/h2\u003e\n\u003cbr\u003e\r\n\u003cp\u003ePara que exista una relación de causalidad, el fenómeno A (el antecedente) debe provocar el fenómeno B (el consecuente). Esta relación es unilateral: B no puede causar A.\u003c/p\u003e\n\u003cp\u003eVolviendo al ejemplo, podríamos investigar si un alto CI causa un alto nivel socioeconómico, o si tener un alto nivel socioeconómico causa un CI elevado. Para algunos, la primera hipótesis parece más plausible; para otros, la segunda. Pero la ciencia no puede basarse en intuiciones, debe poner ambas hipótesis a prueba mediante la experimentación.\u003c/p\u003e\n\u003cp\u003eAquí encontramos otra idea clave: las relaciones de causalidad solo pueden estudiarse, inferirse y contrastarse mediante un \u003cstrong\u003ediseño experimental controlado\u003c/strong\u003e.\u003c/p\u003e\n\u003cp\u003eMientras que la correlación puede calcularse directamente con datos, la causalidad requiere manipular el antecedente para observar cómo afecta al consecuente. Esto solo es posible mediante la experimentación.\u003c/p\u003e\n\u003cp\u003ePero la experimentación tiene sus límites. Hay fenómenos que no se pueden manipular éticamente, como es el caso de las lesiones cerebrales. No podemos provocar lesiones en pacientes sanos; solo podemos estudiar a quienes ya las tienen. Y estas lesiones variarán mucho entre individuos, lo que complica establecer relaciones causales sólidas. Por eso, en ciencia, es difícil encontrar estudios que demuestren de forma definitiva una relación causal.\u003c/p\u003e\n\u003cp\u003eBien, ya hemos aclarado lo fundamental: correlación no es causalidad. Pero, entonces, ¿qué son las correlaciones espurias?\n\u003cbr\u003e\u003cbr\u003e\u003cbr\u003e\u003c/p\u003e\n\u003ch2 id=\"la-estadística-más-castiza-que-la-violetera\"\u003eLa estadística, más castiza que la Violetera\u003c/h2\u003e\n\u003cbr\u003e\r\n\u003ch4 id=\"qué-tiene-que-ver-el-tocino-con-la-velocidad\"\u003e\u003cem\u003e“¿Qué tiene que ver el tocino con la velocidad?”\u003c/em\u003e\u003c/h4\u003e\n\u003cp\u003eEs, sin duda, una de las frases más castizas y también la más adecuada para explicar qué es una correlación espuria. Esta expresión la usamos para evidenciar lo absurda que puede ser la relación que alguien establece entre dos fenómenos que, en realidad, no tienen nada que ver.\u003c/p\u003e\n\u003cp\u003ePero si codificáramos esa frase en un Excel y calculáramos una correlación, podrían pasar dos cosas:\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003eLa relación es, efectivamente, nula (correlación = 0).\u003c/li\u003e\n\u003cli\u003eSorprendentemente, aparece una correlación alta (por ejemplo, -0.89).\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003eImaginemos lo segundo: a mayor consumo de tocino, menor velocidad de desplazamiento. Intrigado, el investigador plantea una hipótesis: una persona que corre a 12 km/h, tras seguir una dieta basada en tocino, pasa a correr a 7 km/h. Realiza el experimento y el voluntario corre a 11 km/h. ¿Qué ha pasado?\u003c/p\u003e\n\u003cp\u003eLa correlación daba una señal clara, pero los resultados no fueron tan extremos como se esperaba. Esto es porque \u003cstrong\u003ela correlación es una ilusión\u003c/strong\u003e, y no cuenta toda la historia. Puede haber un tercer factor que no estamos considerando.\u003c/p\u003e\n\u003cp\u003ePor ejemplo, el sujeto pudo haber usado zapatillas de fibra de carbono que practicamente le hacen volar y el experimentador no lo sabía. En este caso, el tocino no sería el único “culpable”. Esto es una \u003cstrong\u003ecorrelación espuria\u003c/strong\u003e.\n\u003cbr\u003e\u003cbr\u003e\u003cbr\u003e\u003c/p\u003e\n\u003ch2 id=\"that-graph-is-so-crazzzzy-and-real-love-her\"\u003e\u003cem\u003eThat graph is so crazzzzy (and real)!! Love her!!!!\u003c/em\u003e\u003c/h2\u003e\n\u003cbr\u003e\r\n\u003cp\u003eY sí, existen correlaciones espurias entre fenómenos totalmente absurdos. De verdad.\u003c/p\u003e\n\u003cp\u003eUna de mis favoritas es la del calentamiento global y el número de piratas. A medida que ha disminuido el número de piratas desde el siglo XVIII, ha aumentado la temperatura global. Esto sugiere una \u0026ldquo;correlación negativa\u0026rdquo;: menos piratas = más calentamiento global. ¿Significa eso que si aumentamos los piratas se enfriará el planeta? No. \u003cstrong\u003ePorque… CORRELACIÓN NO IMPLICA CAUSALIDAD.\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003eY porque ya sabemos cuál es la causa real del calentamiento global. Aunque los pastafaristas (sí, existe) usan este argumento de los piratas para legitimar su religión. ¿Cómo? No tengo idea. Si no sabes de qué estoy hablando, googlealo, no tiene desperdicio.\u003c/p\u003e\n\u003cp\u003eOtro ejemplo loco: el número de películas protagonizadas por Nicolas Cage correlaciona con el número de inspectores de seguridad de transporte en Dakota del Norte. ¡Correlación de 0.902!\n\u003cbr\u003e\u003cbr\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://www.tylervigen.com/spurious/correlation/5837_the-number-of-movies-nicolas-cage-appeared-in_correlates-with_the-number-of-transportation-security-screeners-in-north-dakota\"\u003e\u003cimg src=\"/5837_the-number-of-movies-nicolas-cage-appeared-in_correlates-with_the-number-of-transportation-security-screeners-in-north-dakota.png\" alt=\"Grafico Nicolas Cage\"\u003e\u003c/a\u003e\n\u003cbr\u003e\u003cbr\u003e\u003c/p\u003e\n\u003cp\u003eSi tienes curiosidad por descubrir que otras muchas correlaciones locas pero reales se dan en el mundo, la web 👉 \u003ca href=\"https://www.tylervigen.com/spurious-correlations\"\u003ehttps://www.tylervigen.com/spurious-correlations\u003c/a\u003e está plagada de ellas.\u003c/p\u003e\n\u003cp\u003eYo ya paso más tiempo aquí que en Tik Tok.\n\u003cbr\u003e\u003cbr\u003e\u003cbr\u003e\u003c/p\u003e\n\u003ch2 id=\"nuevo-álbum-de-lana-del-rey-ultrafascism\"\u003eNuevo álbum de Lana del Rey: \u003cem\u003eUltrafascism\u003c/em\u003e\u003c/h2\u003e\n\u003cbr\u003e\r\n\u003cp\u003eEs broma, más bien esa es la próxima era de Kanye West. Pero no nos desviemos.\u003c/p\u003e\n\u003cp\u003eA estas alturas, creo que no hace falta insistir más en por qué el post del principio no solo no demuestra nada, sino que es engañoso y deshonesto. Es más, tiene un claro trasfondo político. ¿Si no, a qué viene la mención a Donald Trump?\u003c/p\u003e\n\u003cp\u003eEse tweet refuerza un discurso que atenta contra las personas con autismo y da alas al movimiento antivacunas.\u003c/p\u003e\n\u003cp\u003eSi te interesa cómo el mal uso del conocimiento científico y la mala interpretación de los datos se utiliza para legitimar discursos ideológicos dañinos, te recomiendo este vídeo de @aldemial (En Twitter y en Youtube):\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://youtu.be/rw-hup4TFvU?si=GxwyxNvL0_lUjKsK\"\u003e\u003cimg src=\"/@aldemial.jpg\" alt=\"Vídeo @aldemial\"\u003e\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003ePor si algún día te toca defender que los progres no estamos locos. Que, tal y como va el patio… nos va a tocar más pronto que tarde.\n\u003cbr\u003e\u003cbr\u003e\u003cbr\u003e\u003c/p\u003e\n\u003ch2 id=\"el-que-saca-la-ciencia-pa-enseñarla-mal-es-un-parguela\"\u003eEl que saca la ciencia pa enseñarla (mal) es un parguela\u003c/h2\u003e\n\u003cbr\u003e\r\n\u003cp\u003eYo más que una pregunta tengo un par de reflexiones respecto al tweet que ha inspirado este texto.\u003c/p\u003e\n\u003cp\u003eProfesionalmente, me sigue sorprendiendo la escasa formación en metodología básica de muchos investigadores.  En ciencia, cabe preguntarse hasta qué punto uno es responsable de su propia ignorancia. No se trata de culpar por no saberlo todo —nadie lo sabe—, pero sí de reconocer que, en cierto momento, la falta de formación deja de ser una carencia y se convierte en negligencia. Y la negligencia, cuando es persistente y consciente, sí te hace culpable. De lo contrario, no solo queda en entredicho la calidad del trabajo, sino la honestidad, que es aún peor.\n\u003cbr\u003e\u003cbr\u003e\nPersonalmente, me cabrea que se aprovechen del desconocimiento general en estadística para difundir y reforzar discursos y políticas inhumanas. O quizá lo que más me cabrea es que estos casos revelan los frágiles y escasos cortafuegos que tenemos frente a la desinformación, especialmente cuando se disfraza de ciencia. En estos contextos, las mentiras actúan como espejos: nos muestran las grietas en la educación lógico-científica de nuestra sociedad. No sé en qué punto del sistema educativo se tuercen los ladrillos de las barreras que deberían protegernos de los argumentos tramposos, pero la barra niveladora no miente: están torcidos.\n\u003cbr\u003e\u003cbr\u003e\nY conviene recordarlo, porque cuando los datos se manipulan, las consecuencias no son estadísticas: son humanas.\u003c/p\u003e\n","description":"El artículo desmiente un gráfico viral que erróneamente vincula vacunas y autismo, explicando que las correlaciones no implican causalidad. Advierte sobre las correlaciones espurias y critica el uso indebido de la ciencia para promover discursos ideológicos peligrosos.","image":null,"permalink":"http://localhost:1313/blog/tocino_y_velocidad/","title":"Y YA VAN 4854897589492 ESTUDIOS CIENTÍFICOS QUE NO DEMUESTRAN NADA SOBRE EL TOCINO Y LA VELOCIDAD 🎶🎶"},{"content":"\u003cp\u003e\u003cbr\u003e\u003cbr\u003e\u003c/p\u003e\n\u003ch2 id=\"una-aproximación-bayesiana-al-análisis-multinivel\"\u003eUna Aproximación Bayesiana al Análisis Multinivel\u003c/h2\u003e\n\u003cbr\u003e\r\n\u003cp\u003eEl análisis multinivel es un procedimiento estadístico que permite dar cuenta de la idiosincrasia y, por ende, de la variabilidad no solo de los individuos, sino de sus agrupaciones: instituciones, centros educativos, territorios, etc. \u003cstrong\u003eTodo depende de la articulación teórica desde la cual se parta.\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003ePor ejemplo, se puede establecer como objeto de estudio a un grupo de personas formado por varios individuos y analizar las diferencias entre ellos (nivel 1), al mismo tiempo que se examinan las diferencias entre los grupos en los que dichos individuos se encuentran (nivel 2). Asimismo, es posible ampliar el modelo incorporando niveles adicionales, como territorios o países (nivel 3), para captar la variabilidad asociada a estructuras más complejas.\u003c/p\u003e\n\u003cp\u003eEsto da cuenta de la flexibilidad y utilidad de los análisis multinivel, característica muy apreciada por el enfoque bayesiano dado que:\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e“La propia lógica de los métodos bayesianos se adapta de forma natural a los métodos de efectos aleatorios, en los que los parámetros pasan a ser considerados variables aleatorias.”\u003cbr\u003e\n\u003cem\u003e(Revuelta \u0026amp; Ximénez, 2014)\u003c/em\u003e\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003ePor ello, este trabajo se compromete a explorar las posibilidades que ofrece el análisis multinivel bayesiano con datos recogidos en 10 centros educativos sobre el rendimiento de los estudiantes en matemáticas, centrando nuestro interés en la variabilidad existente entre centros, pero también en cada centro.\u003c/p\u003e\n\u003cp\u003e\u003cbr\u003e\u003cbr\u003e\u003c/p\u003e\n\u003ch2 id=\"método\"\u003eMétodo\u003c/h2\u003e\n\u003cp\u003eLos datos se recogieron en 10 centros distintos (\u003ccode\u003eschid\u003c/code\u003e) cuya muestra total es de 260 estudiantes. Las variables medidas son:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003cstrong\u003eRendimiento en matemáticas\u003c/strong\u003e: puntuación en una escala de 0-100. Variable dependiente (\u003ccode\u003emath\u003c/code\u003e).\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eHoras de deberes de matemáticas\u003c/strong\u003e: número de horas diarias que dedica cada estudiante. Variable predictora de primer nivel (\u003ccode\u003ehomework\u003c/code\u003e).\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003ePuesto que nuestro interés reside en la exploración de la flexibilidad de los modelos multinivel, se han estimado 3 modelos:\u003c/p\u003e\n\u003chr\u003e\n\u003cbr\u003e\r\n\u003ch3 id=\"modelo-0-intersecciones-aleatorias-sin-variable-predictora\"\u003e\u003cem\u003eModelo 0: Intersecciones aleatorias sin variable predictora\u003c/em\u003e\u003c/h3\u003e\n\u003cp\u003eNo se tiene en cuenta ninguna variable predictora. Las intersecciones se consideran aleatorias entre centros.\u003cbr\u003e\nParámetros estimados:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eParte fija de la intersección: \\(\\mu_{0}\\)\u003c/li\u003e\n\u003cli\u003eParte aleatoria de la intersección: \\(\\omega^2_{0}\\)\u003c/li\u003e\n\u003cli\u003eVarianza del error: \\(\\sigma^2_{e}\\)\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eEste modelo propone que las medias en el desempeño en matemáticas difieren entre centros, sin considerar ninguna variable predictora. Es el modelo nulo.\u003c/p\u003e\n\u003chr\u003e\n\u003cbr\u003e\r\n\u003ch3 id=\"modelo-1-intersecciones-aletorias-pendientes-fijas-con-una-variable-predictora-de-primer-nivel\"\u003e\u003cem\u003eModelo 1: Intersecciones aletorias, pendientes fijas con una variable predictora de primer nivel\u003c/em\u003e\u003c/h3\u003e\n\u003cp\u003eSe introduce una variable predictora de primer nivel (\u003ccode\u003ehomework\u003c/code\u003e). Se consideran intersecciones aleatorias y pendientes fijas.\u003cbr\u003e\nParámetros estimados:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eParte fija de la intersección: \\(\\mu_{0}\\)\u003c/li\u003e\n\u003cli\u003eParte aleatoria de la intersección: \\(\\omega^2_{0}\\)\u003c/li\u003e\n\u003cli\u003eParte fija de la pendiente: \\(\\mu_{1}\\)\u003c/li\u003e\n\u003cli\u003eVarianza del error: \\(\\sigma^2_{e}\\)\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eEste modelo propone que las medias en el desempeño en matemáticas difieren entre centros teniendo en cuenta \u003ccode\u003ehomework\u003c/code\u003e, pero asume que su efecto es el mismo en todos los colegios.\u003c/p\u003e\n\u003cbr\u003e\r\n\u003cdiv style=\"display:flex; justify-content:center; gap:30px; align-items:flex-start;\"\u003e\r\n  \u003cfigure style=\"margin:0; width:360px; text-align:center;\"\u003e\r\n    \u003cimg src=\"/mcmc_plots_1.png\" alt=\"Cadenas de Markov Monte Carlo de los parámetros del Modelo 1.\" width=\"480\"\u003e\r\n    \u003cfigcaption style=\"font-style:italic; margin-top:8px;\"\u003e\r\n      Figura 4. Cadenas de Markov Monte Carlo (MCMC) de los parámetros del Modelo 1.\r\n    \u003c/figcaption\u003e\r\n  \u003c/figure\u003e\r\n  \u003cfigure style=\"margin:0; width:370px; text-align:center;\"\u003e\r\n    \u003cimg src=\"/pairs_plot_1.png\" alt=\"Gráfica de pares MCMC que muestra las distribuciones marginales (diagonal) y las correlaciones entre parámetros (scatterplots fuera de la diagonal) del Modelo 1.\" width=\"480\"\u003e\r\n    \u003cfigcaption style=\"font-style:italic; margin-top:8px;\"\u003e\r\n      Figura 5. Gráfica de pares MCMC que muestra las distribuciones marginales (diagonal) y las correlaciones entre parámetros (scatterplots fuera de la diagonal) del Modelo 1.\r\n    \u003c/figcaption\u003e\r\n  \u003c/figure\u003e\r\n  \u003cfigure style=\"margin:0; width:370px; text-align:center;\"\u003e\r\n    \u003cimg src=\"/cowplot_1.png\" alt=\"Posterior Predictive Checks del Modelo 1.\" width=\"480\"\u003e\r\n    \u003cfigcaption style=\"font-style:italic; margin-top:8px;\"\u003e\r\n      Figura 6. Posterior Predictive Checks del Modelo 1.\r\n    \u003c/figcaption\u003e\r\n  \u003c/figure\u003e\r\n\u003c/div\u003e\r\n\u003cbr\u003e\u003cbr\u003e\r\n\u003chr\u003e\n\u003cbr\u003e\r\n\u003ch3 id=\"modelo-2-intersecciones-y-pendientes-aletorias-con-una-variable-predictora-de-primer-nivel\"\u003e\u003cem\u003eModelo 2: Intersecciones y pendientes aletorias con una variable predictora de primer nivel\u003c/em\u003e\u003c/h3\u003e\n\u003cp\u003eIgual al Modelo 1, pero con pendientes aleatorias entre centros.\u003cbr\u003e\nParámetros estimados:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eParte fija de la intersección: \\(\\mu_{0}\\)\u003c/li\u003e\n\u003cli\u003eParte aleatoria de la intersección: \\(\\omega^2_{0}\\)\u003c/li\u003e\n\u003cli\u003eParte fija de la pendiente: \\(\\mu_{1}\\)\u003c/li\u003e\n\u003cli\u003eParte aleatoria de la pendiente: \\(\\omega^2_{1}\\)\u003c/li\u003e\n\u003cli\u003eCovarianza intersección–pendiente: \\(\\omega_{01}\\)\u003c/li\u003e\n\u003cli\u003eVarianza del error: \\(\\sigma^2_{e}\\)\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eEste modelo propone que las medias en el desempeño en matemáticas difieren entre centros teniendo en cuenta \u003ccode\u003ehomework\u003c/code\u003e, pero ahora se asume que el efecto de esta variable \u003cstrong\u003eno es el mismo\u003c/strong\u003e en todos los colegios.\u003c/p\u003e\n\u003cp\u003e\u003cbr\u003e\u003cbr\u003e\u003c/p\u003e\n\u003ch2 id=\"anexo-script-de-r-en-combinación-con-lenguaje-stan-cmdstanr\"\u003eANEXO: \u003cem\u003eScript de R en combinación con lenguaje Stan (cmdstanr)\u003c/em\u003e\u003c/h2\u003e\n\u003cbr\u003e\r\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-r\" data-lang=\"r\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e# ==============================================================================\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e# HEADER: Script Information\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e# ==============================================================================\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e# Script Name: cmdstanr_version.R\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e# Author: Alicia Gil Matute\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e# Position: Data Scientist\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e# Date Created: 2025-03-07\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e# Email: aliciagilmatute@gmail.com\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e# ==============================================================================\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e# ==============================================================================\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e# SECTION 1: Load packages\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e# Libraries necessary for the script to function\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e# ==============================================================================\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a6e22e\"\u003elibrary\u003c/span\u003e(MASS)          \u003cspan style=\"color:#75715e\"\u003e# Multivariate gaussian distribution\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a6e22e\"\u003elibrary\u003c/span\u003e(cmdstanr)      \u003cspan style=\"color:#75715e\"\u003e# Estimate bayesian models in Stan (better than rstan)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a6e22e\"\u003elibrary\u003c/span\u003e(posterior)     \u003cspan style=\"color:#75715e\"\u003e# Extract summaries\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a6e22e\"\u003elibrary\u003c/span\u003e(loo)           \u003cspan style=\"color:#75715e\"\u003e# WAIC and LOO estimates\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a6e22e\"\u003elibrary\u003c/span\u003e(haven)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a6e22e\"\u003elibrary\u003c/span\u003e(bayesplot)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a6e22e\"\u003elibrary\u003c/span\u003e(cowplot)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a6e22e\"\u003elibrary\u003c/span\u003e(ggplot2)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a6e22e\"\u003elibrary\u003c/span\u003e(blavaan)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e# ==============================================================================\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e# SECTION 2: Load Data\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e# ==============================================================================\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003emlmdata \u003cspan style=\"color:#f92672\"\u003e\u0026lt;-\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eread_dta\u003c/span\u003e(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;https://stats.idre.ucla.edu/stat/examples/imm/imm10.dta\u0026#34;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ex \u003cspan style=\"color:#f92672\"\u003e\u0026lt;-\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e10\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003emlmdata\u003cspan style=\"color:#f92672\"\u003e$\u003c/span\u003eschid \u003cspan style=\"color:#f92672\"\u003e\u0026lt;-\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eas.factor\u003c/span\u003e(mlmdata\u003cspan style=\"color:#f92672\"\u003e$\u003c/span\u003eschid)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a6e22e\"\u003elevels\u003c/span\u003e(mlmdata\u003cspan style=\"color:#f92672\"\u003e$\u003c/span\u003eschid) \u003cspan style=\"color:#f92672\"\u003e\u0026lt;-\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eas.character\u003c/span\u003e(x)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a6e22e\"\u003estr\u003c/span\u003e(mlmdata)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a6e22e\"\u003eView\u003c/span\u003e(mlmdata)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003edata_stan \u003cspan style=\"color:#f92672\"\u003e\u0026lt;-\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003elist\u003c/span\u003e(N \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003enrow\u003c/span\u003e(mlmdata), \n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e                  J \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003elength\u003c/span\u003e(\u003cspan style=\"color:#a6e22e\"\u003eunique\u003c/span\u003e(mlmdata\u003cspan style=\"color:#f92672\"\u003e$\u003c/span\u003eschid)),\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e                  schid \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eas.numeric\u003c/span\u003e(mlmdata\u003cspan style=\"color:#f92672\"\u003e$\u003c/span\u003eschid), \n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e                  homework \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e mlmdata\u003cspan style=\"color:#f92672\"\u003e$\u003c/span\u003ehomework, \n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e                  math \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e mlmdata\u003cspan style=\"color:#f92672\"\u003e$\u003c/span\u003emath)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a6e22e\"\u003eis.na\u003c/span\u003e(data_stan)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a6e22e\"\u003ehist\u003c/span\u003e(data_stan\u003cspan style=\"color:#f92672\"\u003e$\u003c/span\u003eschid)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a6e22e\"\u003ehist\u003c/span\u003e(data_stan\u003cspan style=\"color:#f92672\"\u003e$\u003c/span\u003ehomework)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a6e22e\"\u003ehist\u003c/span\u003e(data_stan\u003cspan style=\"color:#f92672\"\u003e$\u003c/span\u003emath)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e# ==============================================================================\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e# SECTION 3: Estimate bayesian multilevel model \u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e# Model 0: No predictor variable and Random Intercepts\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e# ==============================================================================\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e#Priors poco informativas:\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e#beta0~normal(0,10);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e#sigma_e~gamma(1,0.5);    \u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e#sigma_u0~gamma(1,0.5);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e#u0~normal(0,sigma_u0);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e# Compilamos el modelo\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ebmultinivel_0 \u003cspan style=\"color:#f92672\"\u003e\u0026lt;-\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003ecmdstan_model\u003c/span\u003e(stan_file \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;model0_cmdstanr_version.stan\u0026#34;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ebmultinivel_0f \u003cspan style=\"color:#f92672\"\u003e\u0026lt;-\u003c/span\u003e bmultinivel_0\u003cspan style=\"color:#f92672\"\u003e$\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003esample\u003c/span\u003e(\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  data \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e data_stan,       \u003cspan style=\"color:#75715e\"\u003e# Stan data\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  chains \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e4\u003c/span\u003e,            \u003cspan style=\"color:#75715e\"\u003e# Number of chains\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  parallel_chains \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e4\u003c/span\u003e,   \u003cspan style=\"color:#75715e\"\u003e# Number of parallel chains\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  iter_warmup \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e500\u003c/span\u003e,     \u003cspan style=\"color:#75715e\"\u003e# Adaptation iterations\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  iter_sampling \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e1500\u003c/span\u003e,  \u003cspan style=\"color:#75715e\"\u003e# Sampled iterations\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  refresh \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e500\u003c/span\u003e,         \u003cspan style=\"color:#75715e\"\u003e# Progress bar at 500 iterations\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  init \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e)              \u003cspan style=\"color:#75715e\"\u003e# All starting values = 0\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e#necesitamos extraer el posterior para visualizar las cadenas de Markov\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eposterior_samples0 \u003cspan style=\"color:#f92672\"\u003e\u0026lt;-\u003c/span\u003e bmultinivel_0f\u003cspan style=\"color:#f92672\"\u003e$\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003edraws\u003c/span\u003e()\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a6e22e\"\u003emcmc_trace\u003c/span\u003e(posterior_samples0, pars \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003ec\u003c/span\u003e(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;beta0\u0026#34;\u003c/span\u003e,\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;sigma_u0\u0026#34;\u003c/span\u003e,\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;sigma_e\u0026#34;\u003c/span\u003e))\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e# Posterior distribution: pairs plots\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a6e22e\"\u003emcmc_pairs\u003c/span\u003e(posterior_samples0, pars\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003ec\u003c/span\u003e(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;beta0\u0026#34;\u003c/span\u003e,\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;sigma_u0\u0026#34;\u003c/span\u003e,\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;sigma_e\u0026#34;\u003c/span\u003e), diag_fun \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;hist\u0026#34;\u003c/span\u003e, \n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e           off_diag_fun \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;scatter\u0026#34;\u003c/span\u003e, off_diag_args \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003elist\u003c/span\u003e(alpha \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e0.5\u003c/span\u003e))\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a6e22e\"\u003emcmc_intervals\u003c/span\u003e(posterior_samples0, pars \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003ec\u003c/span\u003e(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;beta0\u0026#34;\u003c/span\u003e,\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;sigma_u0\u0026#34;\u003c/span\u003e,\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;sigma_e\u0026#34;\u003c/span\u003e) )\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e#escuelas\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eparams \u003cspan style=\"color:#f92672\"\u003e\u0026lt;-\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003epaste0\u003c/span\u003e(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;u0[\u0026#34;\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e10\u003c/span\u003e, \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;]\u0026#34;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a6e22e\"\u003emcmc_trace\u003c/span\u003e(posterior_samples0, pars \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e params)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a6e22e\"\u003emcmc_hist\u003c/span\u003e(posterior_samples0, pars\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003eparams)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e#mcmc_scatter(posterior_samples, pars=c(\u0026#34;u0[1]\u0026#34;,\u0026#34;u0[2]\u0026#34;))\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a6e22e\"\u003emcmc_intervals\u003c/span\u003e(posterior_samples0, pars \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e params)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e#Resultados \u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ebmultinivel_0f\u003cspan style=\"color:#f92672\"\u003e$\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003esummary\u003c/span\u003e()\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e#EL AJUSTE A LOS DATOS (equivalente al ajuste global) con la cmdstanr SE EVALUA CON PPMC:\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e#¿Podemos distinguir los datos observados de datos simulados desde el modelo (math_rep)?\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e# ==============================================================================\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e# SECTION 3.b: Posterior Predictive Model Check (PPMC) MODELO 0\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e# ==============================================================================\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e# Extraer y_rep correctamente desde CmdStanR\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ey_rep_0 \u003cspan style=\"color:#f92672\"\u003e\u0026lt;-\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eas_draws_matrix\u003c/span\u003e(bmultinivel_0f\u003cspan style=\"color:#f92672\"\u003e$\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003edraws\u003c/span\u003e(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;y_rep\u0026#34;\u003c/span\u003e))\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e# Seleccionar solo 100 iteraciones aleatorias (iteraciones)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a6e22e\"\u003eset.seed\u003c/span\u003e(\u003cspan style=\"color:#ae81ff\"\u003e123\u003c/span\u003e)  \u003cspan style=\"color:#75715e\"\u003e# Para reproducibilidad\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ey_rep_subset_0 \u003cspan style=\"color:#f92672\"\u003e\u0026lt;-\u003c/span\u003e y_rep_0\u003cspan style=\"color:#a6e22e\"\u003e[sample\u003c/span\u003e(\u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003enrow\u003c/span\u003e(y_rep_0), \u003cspan style=\"color:#ae81ff\"\u003e100\u003c/span\u003e), ]\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e# Verificar dimensiones\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a6e22e\"\u003edim\u003c/span\u003e(y_rep_subset_0)  \u003cspan style=\"color:#75715e\"\u003e# Debería ser (100, 300)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e# Número de colegios\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eJ \u003cspan style=\"color:#f92672\"\u003e\u0026lt;-\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003elength\u003c/span\u003e(\u003cspan style=\"color:#a6e22e\"\u003eunique\u003c/span\u003e(data_stan\u003cspan style=\"color:#f92672\"\u003e$\u003c/span\u003eschid))\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e# Lista para almacenar los gráficos\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eposterior_plots_list_0 \u003cspan style=\"color:#f92672\"\u003e\u0026lt;-\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003evector\u003c/span\u003e(mode \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;list\u0026#34;\u003c/span\u003e, length \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e J)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e# Generar gráficos PPMC para cada colegio\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003efor\u003c/span\u003e(j \u003cspan style=\"color:#66d9ef\"\u003ein\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e:\u003c/span\u003eJ){\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  posterior_plots_list_0[[j]] \u003cspan style=\"color:#f92672\"\u003e\u0026lt;-\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eppc_dens_overlay\u003c/span\u003e(\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    y \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e data_stan\u003cspan style=\"color:#f92672\"\u003e$\u003c/span\u003emath[data_stan\u003cspan style=\"color:#f92672\"\u003e$\u003c/span\u003eschid \u003cspan style=\"color:#f92672\"\u003e==\u003c/span\u003e j],        \u003cspan style=\"color:#75715e\"\u003e# Datos reales del colegio j\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    yrep \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e y_rep_subset_0[, data_stan\u003cspan style=\"color:#f92672\"\u003e$\u003c/span\u003eschid \u003cspan style=\"color:#f92672\"\u003e==\u003c/span\u003e j]  \u003cspan style=\"color:#75715e\"\u003e# Simulaciones para colegio j\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  ) \u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#a6e22e\"\u003elabs\u003c/span\u003e(title \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003epaste\u003c/span\u003e(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;Colegio\u0026#34;\u003c/span\u003e, j))\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e}\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e# Mostrar los gráficos juntos\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ecowplot\u003cspan style=\"color:#f92672\"\u003e::\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003eplot_grid\u003c/span\u003e(plotlist \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e posterior_plots_list_0)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e#####IMPORTANTE##########\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e#No tiene sentido obtenerlo para beta0, sigma_uo y sigma_e porque son parametros de la distribucion (es un valor puntual \u0026#34;inferido\u0026#34;). En todo caso podria tener sentido obtenerlo para la beta0 ya que es la media de matematicas en las escuelas, pero es mas informativo tenerlo para cada escuela\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e# ==============================================================================\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e# SECTION 4: Estimate bayesian multilevel model \u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e# Model 1: Predictor variable and Random Intercepts and fixed Slopes\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e# ==============================================================================\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e#Priors poco informativas:\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e#beta[1]~normal(0,10);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e#beta[2]~normal(0,10);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e#sigma_e~gamma(1,0.5); \u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e#sigma_u0~gamma(1,0.5);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e#u0~normal(0,sigma_u0);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e# Compilamos el modelo\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ebmultinivel_1  \u003cspan style=\"color:#f92672\"\u003e\u0026lt;-\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003ecmdstan_model\u003c/span\u003e(stan_file \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;model1_cdmstanr_version.stan\u0026#34;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ebmultinivel_1f \u003cspan style=\"color:#f92672\"\u003e\u0026lt;-\u003c/span\u003e bmultinivel_1\u003cspan style=\"color:#f92672\"\u003e$\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003esample\u003c/span\u003e(\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  data \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e data_stan,       \u003cspan style=\"color:#75715e\"\u003e# Stan data\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  chains \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e4\u003c/span\u003e,            \u003cspan style=\"color:#75715e\"\u003e# Number of chains\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  parallel_chains \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e4\u003c/span\u003e,   \u003cspan style=\"color:#75715e\"\u003e# Number of parallel chains\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  iter_warmup \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e500\u003c/span\u003e,     \u003cspan style=\"color:#75715e\"\u003e# Adaptation iterations\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  iter_sampling \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e1500\u003c/span\u003e,  \u003cspan style=\"color:#75715e\"\u003e# Sampled iterations\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  refresh \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e500\u003c/span\u003e,         \u003cspan style=\"color:#75715e\"\u003e# Progress bar at 500 iterations\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  init \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e)              \u003cspan style=\"color:#75715e\"\u003e# All starting values = 0\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e#necesitamos extraer el posterior para visualizar las cadenas de Markov\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eposterior_samples1 \u003cspan style=\"color:#f92672\"\u003e\u0026lt;-\u003c/span\u003e bmultinivel_1f\u003cspan style=\"color:#f92672\"\u003e$\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003edraws\u003c/span\u003e()\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a6e22e\"\u003emcmc_trace\u003c/span\u003e(posterior_samples1, pars \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003ec\u003c/span\u003e(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;beta[1]\u0026#34;\u003c/span\u003e,\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;beta[2]\u0026#34;\u003c/span\u003e,\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;sigma_u0\u0026#34;\u003c/span\u003e,\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;sigma_e\u0026#34;\u003c/span\u003e))\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e# Posterior distribution: pairs plots\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a6e22e\"\u003emcmc_pairs\u003c/span\u003e(posterior_samples1, pars\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003ec\u003c/span\u003e(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;beta[1]\u0026#34;\u003c/span\u003e,\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;beta[2]\u0026#34;\u003c/span\u003e,\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;sigma_u0\u0026#34;\u003c/span\u003e,\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;sigma_e\u0026#34;\u003c/span\u003e), \n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ediag_fun \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;hist\u0026#34;\u003c/span\u003e,  off_diag_fun \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;scatter\u0026#34;\u003c/span\u003e, off_diag_args \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003elist\u003c/span\u003e(alpha \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e0.5\u003c/span\u003e))\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a6e22e\"\u003emcmc_intervals\u003c/span\u003e(posterior_samples1, pars \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003ec\u003c/span\u003e(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;beta[1]\u0026#34;\u003c/span\u003e,\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;beta[2]\u0026#34;\u003c/span\u003e,\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;sigma_u0\u0026#34;\u003c/span\u003e,\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;sigma_e\u0026#34;\u003c/span\u003e) )\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e#escuelas\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eparams \u003cspan style=\"color:#f92672\"\u003e\u0026lt;-\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003epaste0\u003c/span\u003e(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;u0[\u0026#34;\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e10\u003c/span\u003e, \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;]\u0026#34;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a6e22e\"\u003emcmc_trace\u003c/span\u003e(posterior_samples1, pars \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e params)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a6e22e\"\u003emcmc_hist\u003c/span\u003e(posterior_samples1, pars\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003eparams)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e#mcmc_scatter(posterior_samples, pars=c(\u0026#34;u0[1]\u0026#34;,\u0026#34;u0[2]\u0026#34;))\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a6e22e\"\u003emcmc_intervals\u003c/span\u003e(posterior_samples1, pars \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e params)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e#Resultados \u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ebmultinivel_1f\u003cspan style=\"color:#f92672\"\u003e$\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003esummary\u003c/span\u003e()\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e# ==============================================================================\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e# SECTION 4.b: Posterior Predictive Model Check (PPMC) MODELO 1 \u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e# ==============================================================================\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e# Extraer y_rep correctamente desde CmdStanR\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ey_rep_1 \u003cspan style=\"color:#f92672\"\u003e\u0026lt;-\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eas_draws_matrix\u003c/span\u003e(bmultinivel_1f\u003cspan style=\"color:#f92672\"\u003e$\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003edraws\u003c/span\u003e(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;y_rep\u0026#34;\u003c/span\u003e))\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e# Seleccionar solo 100 iteraciones aleatorias (iteraciones)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a6e22e\"\u003eset.seed\u003c/span\u003e(\u003cspan style=\"color:#ae81ff\"\u003e123\u003c/span\u003e)  \u003cspan style=\"color:#75715e\"\u003e# Para reproducibilidad\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ey_rep_subset_1 \u003cspan style=\"color:#f92672\"\u003e\u0026lt;-\u003c/span\u003e y_rep_1\u003cspan style=\"color:#a6e22e\"\u003e[sample\u003c/span\u003e(\u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003enrow\u003c/span\u003e(y_rep_1), \u003cspan style=\"color:#ae81ff\"\u003e100\u003c/span\u003e), ]\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e# Verificar dimensiones\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a6e22e\"\u003edim\u003c/span\u003e(y_rep_subset_1)  \u003cspan style=\"color:#75715e\"\u003e# Debería ser (100, 300)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e# Número de colegios\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eJ \u003cspan style=\"color:#f92672\"\u003e\u0026lt;-\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003elength\u003c/span\u003e(\u003cspan style=\"color:#a6e22e\"\u003eunique\u003c/span\u003e(data_stan\u003cspan style=\"color:#f92672\"\u003e$\u003c/span\u003eschid))\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e# Lista para almacenar los gráficos\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eposterior_plots_list_1 \u003cspan style=\"color:#f92672\"\u003e\u0026lt;-\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003evector\u003c/span\u003e(mode \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;list\u0026#34;\u003c/span\u003e, length \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e J)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e# Generar gráficos PPMC para cada colegio\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003efor\u003c/span\u003e(j \u003cspan style=\"color:#66d9ef\"\u003ein\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e:\u003c/span\u003eJ){\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  posterior_plots_list_1[[j]] \u003cspan style=\"color:#f92672\"\u003e\u0026lt;-\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eppc_dens_overlay\u003c/span\u003e(\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    y \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e data_stan\u003cspan style=\"color:#f92672\"\u003e$\u003c/span\u003emath[data_stan\u003cspan style=\"color:#f92672\"\u003e$\u003c/span\u003eschid \u003cspan style=\"color:#f92672\"\u003e==\u003c/span\u003e j],        \u003cspan style=\"color:#75715e\"\u003e# Datos reales del colegio j\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    yrep \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e y_rep_subset_1[, data_stan\u003cspan style=\"color:#f92672\"\u003e$\u003c/span\u003eschid \u003cspan style=\"color:#f92672\"\u003e==\u003c/span\u003e j]  \u003cspan style=\"color:#75715e\"\u003e# Simulaciones para colegio j\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  ) \u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#a6e22e\"\u003elabs\u003c/span\u003e(title \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003epaste\u003c/span\u003e(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;Colegio\u0026#34;\u003c/span\u003e, j))\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e}\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e# Mostrar los gráficos juntos\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ecowplot\u003cspan style=\"color:#f92672\"\u003e::\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003eplot_grid\u003c/span\u003e(plotlist \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e posterior_plots_list_1)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e# ==============================================================================\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e# SECTION 4.c: Comparacion de modelos (capacidad predictiva)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e# ==============================================================================\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eloo_1f  \u003cspan style=\"color:#f92672\"\u003e\u0026lt;-\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eloo\u003c/span\u003e(x \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e bmultinivel_0f\u003cspan style=\"color:#f92672\"\u003e$\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003edraws\u003c/span\u003e(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;log_lik\u0026#34;\u003c/span\u003e))\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eloo_2f  \u003cspan style=\"color:#f92672\"\u003e\u0026lt;-\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eloo\u003c/span\u003e(x \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e bmultinivel_1f\u003cspan style=\"color:#f92672\"\u003e$\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003edraws\u003c/span\u003e(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;log_lik\u0026#34;\u003c/span\u003e))\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a6e22e\"\u003eloo_compare\u003c/span\u003e(loo_1f, loo_2f)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e# ==============================================================================\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e# SECTION 5.a: Estimate bayesian multilevel model \u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e# Model 2: Predictor variable and Random Intercepts and fixed Slopes\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e# ==============================================================================\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e#Priors poco informativas:\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e#  L_u ~ lkj_corr_cholesky(1);   \u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e#to_vector(z_u) ~ normal(0, 1);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e#beta~normal(0,10);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e#sigma_e~gamma(1,0.5); \u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e#sigma_u~gamma(1,0.5);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ebmultinivel_2  \u003cspan style=\"color:#f92672\"\u003e\u0026lt;-\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003ecmdstan_model\u003c/span\u003e(stan_file \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;model2_cmdstanr_version.stan\u0026#34;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ebmultinivel_2f \u003cspan style=\"color:#f92672\"\u003e\u0026lt;-\u003c/span\u003e bmultinivel_2\u003cspan style=\"color:#f92672\"\u003e$\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003esample\u003c/span\u003e(\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  data \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e data_stan,       \u003cspan style=\"color:#75715e\"\u003e# Stan data\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  chains \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e4\u003c/span\u003e,            \u003cspan style=\"color:#75715e\"\u003e# Number of chains\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  parallel_chains \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e4\u003c/span\u003e,   \u003cspan style=\"color:#75715e\"\u003e# Number of parallel chains\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  iter_warmup \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e500\u003c/span\u003e,     \u003cspan style=\"color:#75715e\"\u003e# Adaptation iterations\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  iter_sampling \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e1500\u003c/span\u003e,  \u003cspan style=\"color:#75715e\"\u003e# Sampled iterations\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  refresh \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e500\u003c/span\u003e,         \u003cspan style=\"color:#75715e\"\u003e# Progress bar at 500 iterations\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  init \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e)              \u003cspan style=\"color:#75715e\"\u003e# All starting values = 0\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e#necesitamos extraer el posterior para visualizar las cadenas de Markov\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eposterior_samples2 \u003cspan style=\"color:#f92672\"\u003e\u0026lt;-\u003c/span\u003e bmultinivel_2f\u003cspan style=\"color:#f92672\"\u003e$\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003edraws\u003c/span\u003e()\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e#L_U[1,1] y L_u[1,2] no ha convergido pero L_u[2,1] si\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a6e22e\"\u003emcmc_trace\u003c/span\u003e(posterior_samples2, pars \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003ec\u003c/span\u003e(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;beta[1]\u0026#34;\u003c/span\u003e,\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;beta[2]\u0026#34;\u003c/span\u003e,\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;sigma_u[1]\u0026#34;\u003c/span\u003e,\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;sigma_u[2]\u0026#34;\u003c/span\u003e,\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;sigma_e\u0026#34;\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e                                        \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;L_u[1,1]\u0026#34;\u003c/span\u003e,\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;L_u[2,1]\u0026#34;\u003c/span\u003e,\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;L_u[2,2]\u0026#34;\u003c/span\u003e))\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e# Posterior distribution: pairs plots\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a6e22e\"\u003emcmc_pairs\u003c/span\u003e(posterior_samples2, pars\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003ec\u003c/span\u003e(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;beta[1]\u0026#34;\u003c/span\u003e,\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;beta[2]\u0026#34;\u003c/span\u003e,\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;sigma_u[1]\u0026#34;\u003c/span\u003e,\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;sigma_u[2]\u0026#34;\u003c/span\u003e,\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;sigma_e\u0026#34;\u003c/span\u003e), \n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e           diag_fun \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;hist\u0026#34;\u003c/span\u003e,  off_diag_fun \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;scatter\u0026#34;\u003c/span\u003e, off_diag_args \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003elist\u003c/span\u003e(alpha \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e0.5\u003c/span\u003e))\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a6e22e\"\u003emcmc_pairs\u003c/span\u003e(posterior_samples2, pars\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003ec\u003c/span\u003e(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;L_u[1,1]\u0026#34;\u003c/span\u003e,\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;L_u[2,1]\u0026#34;\u003c/span\u003e,\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;L_u[2,2]\u0026#34;\u003c/span\u003e), \n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e           diag_fun \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;hist\u0026#34;\u003c/span\u003e,  off_diag_fun \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;scatter\u0026#34;\u003c/span\u003e, off_diag_args \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003elist\u003c/span\u003e(alpha \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e0.5\u003c/span\u003e))\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a6e22e\"\u003emcmc_intervals\u003c/span\u003e(posterior_samples2, pars \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003ec\u003c/span\u003e(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;beta[1]\u0026#34;\u003c/span\u003e,\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;beta[2]\u0026#34;\u003c/span\u003e,\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;sigma_u[1]\u0026#34;\u003c/span\u003e,\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;sigma_u[2]\u0026#34;\u003c/span\u003e,\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;sigma_e\u0026#34;\u003c/span\u003e))\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a6e22e\"\u003emcmc_intervals\u003c/span\u003e(posterior_samples2, pars \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003ec\u003c/span\u003e(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;L_u[1,1]\u0026#34;\u003c/span\u003e,\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;L_u[2,1]\u0026#34;\u003c/span\u003e,\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;L_u[2,2]\u0026#34;\u003c/span\u003e))\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e#escuelas\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eparams \u003cspan style=\"color:#f92672\"\u003e\u0026lt;-\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003epaste0\u003c/span\u003e(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;u0[\u0026#34;\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e10\u003c/span\u003e, \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;]\u0026#34;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a6e22e\"\u003emcmc_trace\u003c/span\u003e(posterior_samples2, pars \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e params)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a6e22e\"\u003emcmc_hist\u003c/span\u003e(posterior_samples2, pars\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003eparams)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e#mcmc_scatter(posterior_samples, pars=c(\u0026#34;u0[1]\u0026#34;,\u0026#34;u0[2]\u0026#34;))\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a6e22e\"\u003emcmc_intervals\u003c/span\u003e(posterior_samples2, pars \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e params)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e#Resultados \u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ebmultinivel_2f\u003cspan style=\"color:#f92672\"\u003e$\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003esummary\u003c/span\u003e()\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ebmultinivel_2f\u003cspan style=\"color:#f92672\"\u003e$\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003esummary\u003c/span\u003e(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;R\u0026#34;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ebmultinivel_2f\u003cspan style=\"color:#f92672\"\u003e$\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003esummary\u003c/span\u003e(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;u0\u0026#34;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e#en el script de stan se puede indicar directamente que calcule la media de cada colegio a partir\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e#de cada u0[j]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e#Los parametros de nuestr interés son:\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e#beta[1]: parte fija interseccion\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e#beta[2]: parte fija pendientes\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e#sigma_u[1]: parte aleatoria interseccion\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e#sigma_u[2]: parte aleatoria pendientes\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e#R[1,2]: covarianza pendientes aleatorias\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e#sigma_e: varianza error\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e#L_u[i,j]: las necesito para crear R[i,j]***\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e# ==============================================================================\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e# SECTION 5.b: Posterior Predictive Model Check (PPMC) MODELO 1 \u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e# ==============================================================================\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e# Extraer y_rep correctamente desde CmdStanR\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ey_rep_2 \u003cspan style=\"color:#f92672\"\u003e\u0026lt;-\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eas_draws_matrix\u003c/span\u003e(bmultinivel_2f\u003cspan style=\"color:#f92672\"\u003e$\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003edraws\u003c/span\u003e(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;y_rep\u0026#34;\u003c/span\u003e))\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e# Seleccionar solo 100 iteraciones aleatorias (iteraciones)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a6e22e\"\u003eset.seed\u003c/span\u003e(\u003cspan style=\"color:#ae81ff\"\u003e123\u003c/span\u003e)  \u003cspan style=\"color:#75715e\"\u003e# Para reproducibilidad\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ey_rep_subset_2 \u003cspan style=\"color:#f92672\"\u003e\u0026lt;-\u003c/span\u003e y_rep_2\u003cspan style=\"color:#a6e22e\"\u003e[sample\u003c/span\u003e(\u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003enrow\u003c/span\u003e(y_rep_2), \u003cspan style=\"color:#ae81ff\"\u003e100\u003c/span\u003e), ]\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e# Verificar dimensiones\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a6e22e\"\u003edim\u003c/span\u003e(y_rep_subset_2)  \u003cspan style=\"color:#75715e\"\u003e# Debería ser (100, 300)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e# Número de colegios\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eJ \u003cspan style=\"color:#f92672\"\u003e\u0026lt;-\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003elength\u003c/span\u003e(\u003cspan style=\"color:#a6e22e\"\u003eunique\u003c/span\u003e(data_stan\u003cspan style=\"color:#f92672\"\u003e$\u003c/span\u003eschid))\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e# Lista para almacenar los gráficos\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eposterior_plots_list_2 \u003cspan style=\"color:#f92672\"\u003e\u0026lt;-\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003evector\u003c/span\u003e(mode \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;list\u0026#34;\u003c/span\u003e, length \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e J)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e# Generar gráficos PPMC para cada colegio\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003efor\u003c/span\u003e(j \u003cspan style=\"color:#66d9ef\"\u003ein\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e:\u003c/span\u003eJ){\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  posterior_plots_list_2[[j]] \u003cspan style=\"color:#f92672\"\u003e\u0026lt;-\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eppc_dens_overlay\u003c/span\u003e(\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    y \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e data_stan\u003cspan style=\"color:#f92672\"\u003e$\u003c/span\u003emath[data_stan\u003cspan style=\"color:#f92672\"\u003e$\u003c/span\u003eschid \u003cspan style=\"color:#f92672\"\u003e==\u003c/span\u003e j],        \u003cspan style=\"color:#75715e\"\u003e# Datos reales del colegio j\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    yrep \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e y_rep_subset_2[, data_stan\u003cspan style=\"color:#f92672\"\u003e$\u003c/span\u003eschid \u003cspan style=\"color:#f92672\"\u003e==\u003c/span\u003e j]  \u003cspan style=\"color:#75715e\"\u003e# Simulaciones para colegio j\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  ) \u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#a6e22e\"\u003elabs\u003c/span\u003e(title \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003epaste\u003c/span\u003e(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;Colegio\u0026#34;\u003c/span\u003e, j))\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e}\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e# Mostrar los gráficos juntos\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ecowplot\u003cspan style=\"color:#f92672\"\u003e::\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003eplot_grid\u003c/span\u003e(plotlist \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e posterior_plots_list_2)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e# ==============================================================================\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e# SECTION 5.c: Comparacion de modelos (capacidad predictiva)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e# ==============================================================================\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eloo_1f  \u003cspan style=\"color:#f92672\"\u003e\u0026lt;-\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eloo\u003c/span\u003e(x \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e bmultinivel_0f\u003cspan style=\"color:#f92672\"\u003e$\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003edraws\u003c/span\u003e(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;log_lik\u0026#34;\u003c/span\u003e))\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eloo_2f  \u003cspan style=\"color:#f92672\"\u003e\u0026lt;-\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eloo\u003c/span\u003e(x \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e bmultinivel_1f\u003cspan style=\"color:#f92672\"\u003e$\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003edraws\u003c/span\u003e(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;log_lik\u0026#34;\u003c/span\u003e))\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eloo_3f \u003cspan style=\"color:#f92672\"\u003e\u0026lt;-\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eloo\u003c/span\u003e(x\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003ebmultinivel_2f\u003cspan style=\"color:#f92672\"\u003e$\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003edraws\u003c/span\u003e(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;log_lik\u0026#34;\u003c/span\u003e))\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a6e22e\"\u003eloo_compare\u003c/span\u003e(loo_1f, loo_2f, loo_3f)\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e\u003cbr\u003e\u003cbr\u003e\u003c/p\u003e\n","description":"Estudio sobre análisis multinivel bayesiano de rendimiento en matemáticas entre 10 centros educativos.","image":null,"permalink":"http://localhost:1313/proyectos/analisis_multinivel/","title":"Análisis Multinivel Bayesiano"},{"content":"\u003cp\u003e\u003cbr\u003e\u003cbr\u003e\u003c/p\u003e\n\u003ch2 id=\"introducción\"\u003eIntroducción\u003c/h2\u003e\n\u003cp\u003eEl análisis factorial confirmatorio (AFC) es la técnica estadística mediante la cual podemos establecer la estructura subyacente de una serie de variables observadas y así poder medir y usar variables no observables. Dicha técnica utiliza la matriz de varianzas y covarianzas para evaluar si los datos ajustan al modelo teórico, así que para realizar un AFC sobre unos datos, podemos introducir como input los datos en bruto o directamente la matriz de varianzas y covarianzas.\u003c/p\u003e\n\u003cp\u003eSin embargo, si en nuestra base de datos existen valores perdidos, el software con el cual vayamos a trabajar va a utilizar alguna estrategia para poder realizar los cálculos sin estos valores perdidos (la más común es \u0026ldquo;eliminación por lista\u0026rdquo;). Esto provoca que nuestros análisis no estén utilizando todas las observaciones recogidas, sino muchas menos. Por ello existen estrategias modernas para no desechar tantos casos, como la imputación múltiple o la imputación por máxima verosimilitud.\u003c/p\u003e\n\u003cp\u003eEste trabajo pretende poner a prueba la estrategia de imputación múltiple para realizar un AFC el cual recibe como input una matriz de varianzas y covarianzas calculada sobre una base de datos. Una base de datos sobre la que se han simulado valores perdidos MCAR y se han imputado mediante dicha estrategia. Queremos estudiar como recupera los parametros estimados de un AFC y sus indices de ajuste y compararlo con el modelo AFC que recibe como input la matriz de varianzas y covarianzas sin simular valores perdidos.\u003c/p\u003e\n\u003cbr\u003e\r\n\u003ch2 id=\"objetivos-e-hipótesis\"\u003eObjetivos e Hipótesis\u003c/h2\u003e\n\u003cp\u003eEl objetivo de este trabajo es el estudio de la recuperación de los parámetros estimados y los índices de ajuste de un modelo AFC que recibe como input una matriz de varianzas y covarianzas de unos datos imputados. De este manera se podrá comprobar si el método de imputación múltiple es recomendable para emplearse en modelos AFC.\u003c/p\u003e\n\u003cp\u003eNuestra hipótesis vaticina que las estimaciones y los índices de ajuste del modelo AFC imputado son muy similares a los del modelo AFC sin imputar.\u003c/p\u003e\n\u003cbr\u003e\r\n\u003ch2 id=\"método\"\u003eMétodo\u003c/h2\u003e\n\u003cp\u003eLa base de datos empleada es la llamada \u0026ldquo;Liderazgo.sav\u0026rdquo; donde se incluyen 15 variables de las cuales 13 son ítems que miden 3 factores relacionados con el liderazgo, pero de los cuales solo 11 forman parte de la estructura factorial (los items 3 y 9 no forman parte de la estructura factorial, como se puede ver en la Figura 1). Los ítems están medidos en una escala Likert con valores 1-7. El tamaño de la muestra es de 96 sujetos y todos los análisis se han realizado con el software R.\u003c/p\u003e\n\u003cbr\u003e\r\n\u003cdiv style=\"display:flex; justify-content:center; gap:30px; align-items:center;\"\u003e\r\n  \u003cfigure style=\"margin:0; width:360px; text-align:center;\"\u003e\r\n    \u003cimg src=\"/Estructura_AFC.png\" alt=\"Estructura Factorial del Modelo de Liderazgo de Frutos (1998)\" width=\"360\"\u003e\r\n    \u003cfigcaption style=\"font-style:italic; margin-top:8px;\"\u003e\r\n      Figura 1. Estructura Factorial del Modelo de Liderazgo de Frutos (1998).\r\n    \u003c/figcaption\u003e\r\n  \u003c/figure\u003e\r\n\u003c/div\u003e\r\n\u003cbr\u003e\u003cbr\u003e\r\n\u003cp\u003eEn primer lugar, se cargan los archivos y se eliminan de la base de datos los ítems 3 y 9 que no forman parte de la estructura, y 2 variables que servían a otros objetivos del estudio. Después se calcula la matriz de varianzas y covarianzas de los datos originales que utilizaremos después para extraer la matriz residual y tener una primera impresión de sí se ha realizado bien o no la imputación múltiple.\u003c/p\u003e\n\u003cp\u003eEn segundo lugar, simulamos valores perdidos MCAR en el 40% de la muestra en todos los ítems y empleamos la librería mice para realizar la imputación múltiple. Se imputan 20 bases de datos mediante el método \u0026ldquo;pmm\u0026rdquo; (predictive mean matching) y después, mediante un bucle for() se realizan las matrices de varianzas y covarianzas de cada una de las 20 bases de datos imputadas.A continuación, calculamos la matriz promedio de esas 20 matrices de varianzas y covarianzas.\u003c/p\u003e\n\u003cp\u003eEn tercer lugar, especificamos el modelo de AFC que se ha presentado en la imagen e introducimos como input esa matriz promedio e indicamos que el método de estimación sea máxima verosimilitud (\u0026ldquo;ML\u0026rdquo;). Indicamos también que imprima los índices de ajuste.\u003c/p\u003e\n\u003cp\u003ePor último, calculamos el modelo AFC con los datos originales (sin valores perdidos) pero introduciendo también como input la matriz de varianzas y covarianzas.\u003c/p\u003e\n\u003cp\u003e\u003cbr\u003e\u003cbr\u003e\u003c/p\u003e\n\u003ch2 id=\"resultados\"\u003eResultados\u003c/h2\u003e\n\u003cbr\u003e\r\n\u003ch3 id=\"índices-de-ajuste-afc-imputado-vs-índices-de-ajuste-afc-original\"\u003eÍndices de Ajuste AFC imputado VS Índices de Ajuste AFC original\u003c/h3\u003e\n\u003cbr\u003e\r\n\u003cdiv style=\"display:flex; justify-content:center; gap:30px; align-items:flex-start;\"\u003e\r\n  \u003cfigure style=\"margin:0; width:360px; text-align:center;\"\u003e\r\n    \u003cimg src=\"/ajuste_imp.png\" alt=\"Output de R de los índices de ajuste del modelo imputado\" width=\"355\"\u003e\r\n    \u003cfigcaption style=\"font-style:italic; margin-top:8px;\"\u003e\r\n      Figura 2. Índices de ajuste \r\n      del modelo AFC imputado.\r\n    \u003c/figcaption\u003e\r\n  \u003c/figure\u003e\r\n  \u003cfigure style=\"margin:0; width:370px; text-align:center;\"\u003e\r\n    \u003cimg src=\"/Ajuste_raw.png\" alt=\"Output de R de los índices de ajuste del modelo no imputado\" width=\"380\"\u003e\r\n    \u003cfigcaption style=\"font-style:italic; margin-top:8px;\"\u003e\r\n      Figura 3. Índices de ajuste \r\n      del modelo AFC no imputado.\r\n    \u003c/figcaption\u003e\r\n  \u003c/figure\u003e\r\n\u003c/div\u003e\r\n\u003cbr\u003e\u003cbr\u003e\r\n\u003cp\u003eComo podemos observar, el valor del estadístico de chi-cuadrado resulta significativo en ambso modelos lo que signfica que el modelo propuesto ajusta a los datos, pero con valores de chi-cuadrado diferentes, en el modelo de AFC imputado se obtiene un valor de chi-cuadrado de 172.399 y en el modelo de AFC original un chi-cuadrado de 80.412. Igualmente, estan empleando la misma cantidad de información porque ambos están empleando 41 grados de libertad. Por otro lado, el índice de RMSEA que también evalua el ajuste del modelo a los datos resulta mayor a 0.05 en ambos modelos, con lo cual recibimos información contradictoria. Como el estadístico chi-cuadrado es tan sensible a la muestra, RMSEA resulta ser un índice más robusto con lo cual, basandonos en él, tanto el modelo AFC imputado como el modelo AFC original tiene un mal ajuste a los datos. Está cuestión, se comentará en los siguientes apartados.\u003c/p\u003e\n\u003cp\u003eRespecto a los índices TLI y CFI hay diferencias más claras entre ambos modelos. Mientras que en modelo AFC imputado los valores estimados de TLI como CFI no superan el 0.95, en el modelo de AFC original sí son más próximos a 0.95. Con lo cual, el modelo AFC imputado recupera mal la mejora del ajuste respecto al modelo nulo.\u003c/p\u003e\n\u003cp\u003e\u003cbr\u003e\u003cbr\u003e\u003c/p\u003e\n\u003ch3 id=\"estimaciones-de-parámetros-modelo-afc-imputado-vs-estimaciones-de-parámetros-modelo-afc-original\"\u003eEstimaciones de parámetros modelo AFC imputado VS estimaciones de parámetros modelo AFC original\u003c/h3\u003e\n\u003cbr\u003e\r\n\u003cdiv style=\"display:flex; gap:20px; align-items:flex-start;\"\u003e\r\n  \u003cfigure\u003e\r\n    \u003cimg src=\"/estimaciones_imp.png\" alt=\"Output de R de las estimaciones de los parámetros del modelo imputado\" width=\"440\"\u003e\r\n    \u003cfigcaption style=\"text-align:center; font-style:italic; margin-top:8px;\"\u003e\r\n      Figura 4. Estimaciones de los parámetros \r\n      del modelo AFC imputado.\r\n    \u003c/figcaption\u003e\r\n  \u003c/figure\u003e\r\n  \u003cfigure\u003e\r\n    \u003cimg src=\"/estimaciones_raw.png\" alt=\"Output de R de las estimaciones de los parámetros del modelo no imputado\" width=\"440\"\u003e\r\n    \u003cfigcaption style=\"text-align:center; font-style:italic; margin-top:8px;\"\u003e\r\n      Figura 5. Estimaciones de los parámetros \r\n      del modelo AFC no imputado.\r\n    \u003c/figcaption\u003e\r\n  \u003c/figure\u003e\r\n\u003c/div\u003e\r\n\u003cbr\u003e\u003cbr\u003e\r\n\u003ch2 id=\"conclusiones\"\u003eConclusiones\u003c/h2\u003e\n\u003cp\u003eAntes de comentar los resultados es importante aclarar lo siguiente: este trabajo no pretende evaluar el ajuste del modelo AFC original ni mejorarlo, y mucho menos pretendemos que el modelo AFC imputado supere en ajuste al modelo original, es imposible dado que solo podemos aspirar a que se parezca al ajuste original. Si el modelo AFC original tiene un ajuste mediocre (como es el caso) el ajuste del modelo imputado, por mucho que pueda parecerse al original, será igual de mediocre. Y lo mismo ocurre con los valores estimados para los pesos factoriales, si el modelo original tiene problemas obtendremos pesos factoriales mayores a 1, también los obtendrá el modelo imputado. Así que, lo que nos interesa evaluar dados los objetivos del estudio es como el modelo AFC imputado se parece al modelo AFC original, y no si alcanza un buen ajuste o pesos factoriales adecuados, porque el modelo AFC original no los alcanza.\u003c/p\u003e\n\u003cp\u003ePor lo general podemos concluir que el método de imputación múltiple es eficaz porque recupera con bastante robusted el modelo AFC original introduciendo como input la matriz de varianzas y covarianzas. Los índices de ajuste, aunque en concreto TLI y CFI son los que más difieren (en el modelo AFC imputado interpretamos que no ajusta y en el modelo AFC original sí) no son valores muy dispares entre modelos y en términos muy generales, tienen un ajuste muy similar. Finalmente, respecto a los valores de los pesos factoriales y de las covarianzas entre factores, aunque puedan no coincidir, son diferencias mínimas y se llegan a las mismas interpretaciones.\u003c/p\u003e\n\u003cp\u003ePor último, aunque no hayamos podido identificar el problema que puede subyacer al modelo AFC original para obtener unos índices de ajuste bastante mejorables y unos pesos factoriales superiores a 1, nuestra sospecha es que se debe al tamaño muestral. El tamaño muestral del estudio es de 96 sujetos y la literatura recomienda emplear muestras de 300 sujetos (200 mínimo) para realizar Análisis Factoriales Confirmatorios robustos. Por ello, nuestra recomendación para futuros estudios es que se recoja un tamaño muestral adecuado, pero no excesivamente grande dado que chi-cuadrado es sensible al tamaño muestral.\u003c/p\u003e\n\u003cp\u003e\u003cbr\u003e\u003cbr\u003e\u003c/p\u003e\n\u003ch2 id=\"anexo-script-de-r\"\u003eANEXO: \u003cem\u003e\u0026ldquo;Script de R\u0026rdquo;\u003c/em\u003e\u003c/h2\u003e\n\u003c!-- idea: incluir los notebooks con jupyter book como anexo de cada proyecto?? --\u003e\r\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-r\" data-lang=\"r\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a6e22e\"\u003erm\u003c/span\u003e(list\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003els\u003c/span\u003e())\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a6e22e\"\u003eset.seed\u003c/span\u003e(\u003cspan style=\"color:#ae81ff\"\u003e123\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a6e22e\"\u003elibrary\u003c/span\u003e(haven)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a6e22e\"\u003elibrary\u003c/span\u003e(mice)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a6e22e\"\u003elibrary\u003c/span\u003e(reshape2) \n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a6e22e\"\u003elibrary\u003c/span\u003e(mitml)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a6e22e\"\u003elibrary\u003c/span\u003e(lme4)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a6e22e\"\u003elibrary\u003c/span\u003e(lavaan)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a6e22e\"\u003elibrary\u003c/span\u003e(semPlot)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a6e22e\"\u003elibrary\u003c/span\u003e(psych)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003edatos \u003cspan style=\"color:#f92672\"\u003e\u0026lt;-\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eread_sav\u003c/span\u003e(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;Liderazgo.sav\u0026#34;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a6e22e\"\u003eView\u003c/span\u003e(datos)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a6e22e\"\u003etable\u003c/span\u003e(\u003cspan style=\"color:#a6e22e\"\u003eis.na\u003c/span\u003e(datos))\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e#obtenemos la matriz de var-cov de los datos  brutos para chequear luego como recupera la matriz la imputación múltiple obteniendo la matriz residual\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003edatos \u003cspan style=\"color:#f92672\"\u003e\u0026lt;-\u003c/span\u003e datos[,\u003cspan style=\"color:#f92672\"\u003e-\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003ec\u003c/span\u003e(\u003cspan style=\"color:#ae81ff\"\u003e14\u003c/span\u003e,\u003cspan style=\"color:#ae81ff\"\u003e15\u003c/span\u003e,\u003cspan style=\"color:#ae81ff\"\u003e3\u003c/span\u003e,\u003cspan style=\"color:#ae81ff\"\u003e9\u003c/span\u003e)] \u003cspan style=\"color:#75715e\"\u003e#quitamos las variables de los factores y de los ítems que no forman parte del modelo CFA\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eraw_m \u003cspan style=\"color:#f92672\"\u003e\u0026lt;-\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003ecov\u003c/span\u003e(datos)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eraw_m\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e#Simulamos valores NA al 40% (MCAR)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003edatos_NA \u003cspan style=\"color:#f92672\"\u003e\u0026lt;-\u003c/span\u003e datos\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a6e22e\"\u003etable\u003c/span\u003e(\u003cspan style=\"color:#a6e22e\"\u003eis.na\u003c/span\u003e(datos_NA))\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e# Proporción de valores perdidos a introducir (puedes ajustar según tus necesidades)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eproporcion_NA\u003cspan style=\"color:#f92672\"\u003e\u0026lt;-\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e0.4\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e# Obtener el número de filas y columnas en tus datos\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003enum_filas \u003cspan style=\"color:#f92672\"\u003e\u0026lt;-\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003enrow\u003c/span\u003e(datos_NA)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003enum_columnas \u003cspan style=\"color:#f92672\"\u003e\u0026lt;-\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003encol\u003c/span\u003e(datos_NA)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e# Calcular el número total de valores a introducir como perdidos\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003enum_NA \u003cspan style=\"color:#f92672\"\u003e\u0026lt;-\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eround\u003c/span\u003e(proporcion_NA\u003cspan style=\"color:#f92672\"\u003e*\u003c/span\u003e num_filas \u003cspan style=\"color:#f92672\"\u003e*\u003c/span\u003e num_columnas)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e# Generar ubicaciones aleatorias para los valores perdidos\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eubicaciones_NA \u003cspan style=\"color:#f92672\"\u003e\u0026lt;-\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003edata.frame\u003c/span\u003e(\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  fila \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003esample\u003c/span\u003e(\u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e:\u003c/span\u003enum_filas, num_NA, replace \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003eTRUE\u003c/span\u003e),\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  columna \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003esample\u003c/span\u003e(\u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e:\u003c/span\u003enum_columnas, num_NA, replace \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003eTRUE\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e# Introducir valores perdidos en las ubicaciones generadas\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003efor\u003c/span\u003e (i \u003cspan style=\"color:#66d9ef\"\u003ein\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e:\u003c/span\u003enum_NA) {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  datos_NA[ubicaciones_NA\u003cspan style=\"color:#f92672\"\u003e$\u003c/span\u003efila[i], ubicaciones_NA\u003cspan style=\"color:#f92672\"\u003e$\u003c/span\u003ecolumna[i]] \u003cspan style=\"color:#f92672\"\u003e\u0026lt;-\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003eNA\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e}\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a6e22e\"\u003etable\u003c/span\u003e(\u003cspan style=\"color:#a6e22e\"\u003eis.na\u003c/span\u003e(datos_NA))\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a6e22e\"\u003ewrite.csv\u003c/span\u003e(datos_NA,\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;liderazgo_NA.txt\u0026#34;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a6e22e\"\u003eView\u003c/span\u003e(datos_NA)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a6e22e\"\u003estr\u003c/span\u003e(datos_NA)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e#imputamos datos\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eimp \u003cspan style=\"color:#f92672\"\u003e\u0026lt;-\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003emice\u003c/span\u003e(datos_NA, seed \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e20000\u003c/span\u003e, meth \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;pmm\u0026#34;\u003c/span\u003e, m \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e20\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eimp\u003cspan style=\"color:#f92672\"\u003e$\u003c/span\u003eimp\u003cspan style=\"color:#f92672\"\u003e$\u003c/span\u003ep1  \u003cspan style=\"color:#75715e\"\u003e# Imputación del primer item en las 20 bases de datos\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ecomplete_data \u003cspan style=\"color:#f92672\"\u003e\u0026lt;-\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003ecomplete\u003c/span\u003e(imp, \u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e)  \u003cspan style=\"color:#75715e\"\u003e# Imputación de la base de datos 1, los 13 items\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ematrices \u003cspan style=\"color:#f92672\"\u003e\u0026lt;-\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003elist\u003c/span\u003e()\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003efor\u003c/span\u003e (i \u003cspan style=\"color:#66d9ef\"\u003ein\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e20\u003c/span\u003e) {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  data \u003cspan style=\"color:#f92672\"\u003e\u0026lt;-\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003ecomplete\u003c/span\u003e(imp, action \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e i)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  cov_matrix \u003cspan style=\"color:#f92672\"\u003e\u0026lt;-\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003ecov\u003c/span\u003e(data)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  matrices[[i]] \u003cspan style=\"color:#f92672\"\u003e\u0026lt;-\u003c/span\u003e cov_matrix\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e}\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a6e22e\"\u003ehead\u003c/span\u003e(matrices)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e# Ahora promedio las matrices de covarianza\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eaverage_cov_matrix \u003cspan style=\"color:#f92672\"\u003e\u0026lt;-\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eReduce\u003c/span\u003e(`+`, matrices) \u003cspan style=\"color:#f92672\"\u003e/\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003elength\u003c/span\u003e(matrices)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e################Recuperación de la matriz (matriz residual)###################\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e#raw_m[upper.tri(raw_m)] \u0026lt;- 0\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e#raw_m\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e#average_cov_matrix[upper.tri(average_cov_matrix)] \u0026lt;- 0\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e#average_cov_matrix\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e#m_dif \u0026lt;- raw_m-average_cov_matrix  #(residuos muy bajos,la imputacion recupera bien)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e#m_dif\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e###############################################################################\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e# Definiendo el modelo de CFA\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003emodelo \u003cspan style=\"color:#f92672\"\u003e\u0026lt;-\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#e6db74\"\u003e  \n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#e6db74\"\u003e  factor1 =~ p1 + p2 + p8 + p5 + p12\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#e6db74\"\u003e  factor2 =~ p4 + p7 + p10 + p11\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#e6db74\"\u003e  factor3 =~ p6 + p13\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#e6db74\"\u003e  \n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#e6db74\"\u003e  factor1 ~~ factor2\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#e6db74\"\u003e  factor1 ~~ factor3\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#e6db74\"\u003e  factor2 ~~ factor3\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e# Realizando el CFA con la matriz de covarianza promediada\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eafc \u003cspan style=\"color:#f92672\"\u003e\u0026lt;-\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003ecfa\u003c/span\u003e(modelo, sample.cov \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e average_cov_matrix, sample.nobs \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e96\u003c/span\u003e, std.lv \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003eTRUE\u003c/span\u003e, meanstructure \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003eTRUE\u003c/span\u003e, estimator \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;ML\u0026#34;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a6e22e\"\u003esummary\u003c/span\u003e(afc, standardized\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#66d9ef\"\u003eTRUE\u003c/span\u003e, fit.measures\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#66d9ef\"\u003eTRUE\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a6e22e\"\u003ecoef\u003c/span\u003e(afc)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a6e22e\"\u003esemPaths\u003c/span\u003e(afc,\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;std\u0026#34;\u003c/span\u003e,edge.label.cex\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e0.5\u003c/span\u003e, curvePivot \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003eTRUE\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e############## Realizamos también el CFA con los datos brutos (sin simular datos MCAR) e introduciendo como input la matriz de varianzas-covarianzas##################\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eraw_datos \u003cspan style=\"color:#f92672\"\u003e\u0026lt;-\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eread_sav\u003c/span\u003e(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;Liderazgo.sav\u0026#34;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a6e22e\"\u003estr\u003c/span\u003e(raw_datos)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e#eliminamos variables innecesarias y las que no estan incluidas en el modelo\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eraw_datos \u003cspan style=\"color:#f92672\"\u003e\u0026lt;-\u003c/span\u003e raw_datos[,\u003cspan style=\"color:#f92672\"\u003e-\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003ec\u003c/span\u003e(\u003cspan style=\"color:#ae81ff\"\u003e14\u003c/span\u003e,\u003cspan style=\"color:#ae81ff\"\u003e15\u003c/span\u003e,\u003cspan style=\"color:#ae81ff\"\u003e3\u003c/span\u003e,\u003cspan style=\"color:#ae81ff\"\u003e9\u003c/span\u003e)]\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a6e22e\"\u003ehead\u003c/span\u003e(raw_datos)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ematriz \u003cspan style=\"color:#f92672\"\u003e\u0026lt;-\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003ecov\u003c/span\u003e(raw_datos)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ematriz\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e#CFA \u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eraw_modelo \u003cspan style=\"color:#f92672\"\u003e\u0026lt;-\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#e6db74\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#e6db74\"\u003e  factor1=~p1+p2+p8+p5+p12\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#e6db74\"\u003e  factor2=~p4+p7+p10+p11\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#e6db74\"\u003e  factor3=~p6+p13\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#e6db74\"\u003e  \n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#e6db74\"\u003e  factor1~~factor2\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#e6db74\"\u003e  factor1~~factor3\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#e6db74\"\u003e  factor2~~factor3\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#e6db74\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eraw_afc \u003cspan style=\"color:#f92672\"\u003e\u0026lt;-\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003ecfa\u003c/span\u003e(raw_modelo, sample.cov \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e matriz, sample.nobs \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e96\u003c/span\u003e, std.lv \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003eTRUE\u003c/span\u003e, meanstructure \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003eTRUE\u003c/span\u003e, estimator \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;ML\u0026#34;\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a6e22e\"\u003esummary\u003c/span\u003e(raw_afc, standardized\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#66d9ef\"\u003eTRUE\u003c/span\u003e, fit.measures\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#66d9ef\"\u003eTRUE\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a6e22e\"\u003ecoef\u003c/span\u003e(raw_afc)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a6e22e\"\u003esemPaths\u003c/span\u003e(raw_afc,\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;std\u0026#34;\u003c/span\u003e,edge.label.cex\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e0.5\u003c/span\u003e, curvePivot \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003eTRUE\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e","description":"Estudio de la Recuperación de un Análisis Factorial Confirmatorio sobre una matriz de varianzas y covarianzas cuyos datos presentaban valores perdidos.","image":null,"permalink":"http://localhost:1313/proyectos/valores_perdidos/","title":"Estudio de Valores Perdidos en R"},{"content":"\u003cp\u003e\u003cbr\u003e\u003cbr\u003e\u003c/p\u003e\n\u003ch2 id=\"árbol-de-decisión-y-bosques-aleatorios\"\u003eÁrbol de Decisión y Bosques Aleatorios\u003c/h2\u003e\n\u003cbr\u003e\r\n\u003ch3 id=\"introducción\"\u003eIntroducción\u003c/h3\u003e\n\u003cp\u003eLa base de datos que emplearemos es una base de datos que recoge información de 200 personas, en concreto, se recoge información sobre su Edad, Sexo, Presión en Sangre, Niveles de Colesterol, Niveles de Sodio y Potasio y droga/medicación que se le receta. Queremos realizar un árbol aleatorio que tenga en cuenta todas estas variables y sea capaz de predecir qué droga/medicación debemos recetar a cada paciente.\u003c/p\u003e\n\u003cp\u003eEn primer lugar vamos a realizar una reestructuración de los datos y después un breve Análisis Exploratorio, para ver qué tipo de datos tenemos, cuantas categorías, valores perdidos, etc. Aunque ya adelantamos que no hay valores perdidos y que las variables cuantitativas son dad y Sodio-Potasio y el resto son categóricas.\u003c/p\u003e\n\u003cbr\u003e\r\n\u003ch3 id=\"árbol-de-decisión\"\u003eÁrbol de Decisión\u003c/h3\u003e\n\u003cbr\u003e\r\n\u003cdiv style=\"display:flex; justify-content:center; gap:30px; align-items:center;\"\u003e\r\n  \u003cfigure style=\"margin:0; width:360px; text-align:center;\"\u003e\r\n    \u003cimg src=\"/accuracy_tree.png\" alt=\"Métricas de Evaluación del Árbol de Decisión\" width=\"360\"\u003e\r\n    \u003cfigcaption style=\"font-style:italic; margin-top:8px;\"\u003e\r\n      Figura 1. Métricas de Evaluación del Árbol de Decisión.\r\n    \u003c/figcaption\u003e\r\n  \u003c/figure\u003e\r\n\u003c/div\u003e\r\n\u003cbr\u003e\r\n\u003cp\u003eComo podemos ver el \u003cem\u003eaccuracy\u003c/em\u003e del Árbol de Decisión es de 0.98 y su matriz de confusión es ideal (solo 1 caso no es clasificado correctamente). Con él, podríamos utilizarlo para predecir un caso nuevo que no existiera ni en el conjunto de entrenamiento ni el conjunto de test como se hace en el siguiente bloque de código:\n\u003cbr\u003e\u003cbr\u003e\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-python\" data-lang=\"python\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eX \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e np\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003earray([\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;20\u0026#39;\u003c/span\u003e, \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;Male\u0026#39;\u003c/span\u003e, \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;LOW\u0026#39;\u003c/span\u003e, \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;LOW\u0026#39;\u003c/span\u003e, \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;10\u0026#39;\u003c/span\u003e])\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003elabel \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e LabelEncoder()\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eX \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e label\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003efit_transform(X)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ey_pred \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e clf\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003epredict(X\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003ereshape(\u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e, \u003cspan style=\"color:#f92672\"\u003e-\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e))\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ey_pred\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003ePero el Árbol de Decisión adolece de un problema que los Bosques Aleatorios no tienen: \u003cstrong\u003eson poco generalizables\u003c/strong\u003e. Los Bosques Aleatorios al implementar múltiples árboles, permiten una clasificación más robusta y confiable.\n\u003cbr\u003e\u003cbr\u003e\u003c/p\u003e\n\u003ch3 id=\"bosques-aleatorios\"\u003eBosques Aleatorios\u003c/h3\u003e\n\u003ch3 id=\"anexo-1-script-árboles-y-bosques-aleatorios\"\u003eAnexo 1: \u003cem\u003eScript Árboles y Bosques Aleatorios\u003c/em\u003e\u003c/h3\u003e\n\u003chr\u003e\n\u003cp\u003e\u003cbr\u003e\u003cbr\u003e\u003c/p\u003e\n","description":"Una serie de proyectos de clasificación con técnicas de Machine Learning Supervisado","image":null,"permalink":"http://localhost:1313/proyectos/ml_supervised/","title":"Machine Learning Supervisado"},{"content":"","description":"Algoritmo Genético que pretende resolver el problema del viajante (TSP) desde dos lógicas diferentes.","image":null,"permalink":"http://localhost:1313/proyectos/algoritmo_genetico/","title":"Algoritmo Genético"},{"content":"","description":"Una serie de proyectos de clustering y reducción de dimensionalidad.","image":null,"permalink":"http://localhost:1313/proyectos/ml_unsupervised/","title":"Machine Learning No Supervisado"},{"content":"","description":"Análisis y modelado de texto con técnicas de NLP, incluyendo tokenización, lematización y modelos de clasificación de texto usando NLTK y spaCy.","image":null,"permalink":"http://localhost:1313/proyectos/nlp_reviews/","title":"Procesamiento de Lenguaje Natural"},{"content":"","description":"Una serie de proyectos de simulación relacionados con la estadística.","image":null,"permalink":"http://localhost:1313/proyectos/simulacion/","title":"Simulación Estadística"}]